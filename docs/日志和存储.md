# 日志和Store使用指南

## 概述

本项目集成了 `electron-log` 和 `electron-store` 两个核心库，为应用提供了完整的日志记录和数据存储解决方案。所有进程（主进程、渲染进程、预加载脚本）都配置了统一的日志和错误捕获机制。

## 日志系统 (electron-log)

### 配置说明

- **主进程**: 直接使用 `electron-log` 的默认配置
- **渲染进程**: 通过预加载脚本暴露的 `api.log` 接口
- **错误捕获**: 集成了全局错误处理机制

### 主进程日志使用

```typescript
import log from "electron-log";

// 基本日志记录
log.info("应用启动成功");
log.warn("这是一个警告信息");
log.error("发生了一个错误");
log.debug("调试信息");

// 带参数的日志
log.info("用户登录", { userId: 123, username: "john" });

// 错误日志（会自动包含堆栈信息）
try {
  // 一些可能出错的代码
} catch (error) {
  log.error("操作失败", error);
}
```

### 渲染进程日志使用

```typescript
// 使用全局 api 对象（推荐）
api.log.info("渲染进程日志");
api.log.warn("警告信息");
api.log.error("错误信息");
api.log.debug("调试信息");

// 带参数的日志
api.log.info("用户操作", { action: "click", target: "button" });

// 错误处理
api.log.throw_error(new Error("渲染进程错误"), {
  title: "操作失败",
});
```

### 日志级别

- `error`: 错误信息
- `warn`: 警告信息
- `info`: 一般信息
- `debug`: 调试信息

### 日志文件位置

- **开发环境**: 项目根目录下的 `logs/` 文件夹
- **生产环境**: 用户数据目录下的 `logs/` 文件夹

## 数据存储 (electron-store)

### 配置说明

- **主进程**: 直接使用 `electron-store` 实例
- **渲染进程**: 通过 IPC 路由调用存储方法

### 主进程存储使用

```typescript
import Store from "electron-store";

const store = new Store();

// 设置数据
store.set("user.name", "John Doe");
store.set("user.settings.theme", "dark");

// 获取数据
const userName = store.get("user.name");
const theme = store.get("user.settings.theme", "light"); // 带默认值

// 删除数据
store.delete("user.name");

// 清空所有数据
store.clear();

// 检查数据是否存在
const hasUser = store.has("user.name");
```

### 渲染进程存储使用

```typescript
// 获取存储数据
const userName = await api.ipcRouter.storeGet("user.name");
const theme = await api.ipcRouter.storeGet("user.settings.theme");

// 设置存储数据
await api.ipcRouter.storeSet("user.name", "John Doe");
await api.ipcRouter.storeSet("user.settings.theme", "dark");

// 删除存储数据
await api.ipcRouter.storeDeleteKey("user.name");

// 清空所有存储数据
await api.ipcRouter.storeClear();
```

### 存储配置类型

项目定义了 `AppConfig` 类型来规范存储的数据结构：

```typescript
// 在 src/shared/types.ts 中定义
interface AppConfig {
  user: {
    name: string;
    email: string;
  };
  settings: {
    theme: "light" | "dark";
    language: string;
    autoUpdate: boolean;
  };
  // 更多配置项...
}
```

### 最佳实践

1. **日志记录**:
   - 使用合适的日志级别
   - 包含必要的上下文信息
   - 避免记录敏感信息（密码、令牌等）

2. **数据存储**:
   - 使用嵌套的键名组织数据
   - 为获取操作提供默认值
   - 定期清理不需要的数据

3. **错误处理**:
   - 使用 `api.log.throw_error()` 记录渲染进程错误
   - 在主进程中使用 try-catch 包装可能出错的操作

### 调试技巧

1. **查看日志文件**: 在开发过程中可以直接查看 `logs/` 目录下的日志文件
2. **使用日志查看器**: 通过 `api.ipcRouter.windowOpenLogViewer()` 打开内置的日志查看器
3. **导出日志**: 使用 `api.ipcRouter.logExportLogs('json')` 导出日志进行分析

### 常见问题

**Q: 日志文件过大怎么办？**
A: electron-log 会自动轮转日志文件，可以通过配置调整轮转策略。

**Q: 如何在不同环境使用不同的日志级别？**
A: 可以通过环境变量或配置文件设置日志级别。

**Q: 存储数据丢失怎么办？**
A: 检查用户数据目录权限，确保应用有写入权限。
