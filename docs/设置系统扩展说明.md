# è®¾ç½®ç³»ç»Ÿæ‰©å±•è¯´æ˜

## æ¦‚è¿°

å°†åŸæœ‰çš„æ’ä»¶è®¾ç½®ç³»ç»Ÿæ‰©å±•ä¸ºé€šç”¨çš„è®¾ç½®ç³»ç»Ÿï¼Œæ”¯æŒåº”ç”¨ç¨‹åºè®¾ç½®å’Œæ’ä»¶è®¾ç½®çš„ç»Ÿä¸€ç®¡ç†ã€‚

**è®¾è®¡åŸåˆ™**ï¼š

- åº”ç”¨è®¾ç½®ç›´æ¥æ˜ å°„åˆ° `AppConfig` æ¥å£çš„å­—æ®µï¼Œæ— éœ€é¢å¤–çš„å­˜å‚¨å±‚
- æ’ä»¶è®¾ç½®ä½¿ç”¨ç‹¬ç«‹çš„ `pluginSettings` å­˜å‚¨
- ä¸åŒ…æ‹¬è¿è¡Œæ—¶æ•°æ®ï¼ˆå¦‚ recentApps, pinnedApps, fileList, installedPluginsï¼‰
- ä¸åŒ…æ‹¬æœ‰ä¸“é—¨ç®¡ç†é¡µé¢çš„é…ç½®ï¼ˆå¦‚ hotkeys, customHotkeysï¼‰
- ä¸åŒ…æ‹¬ UI å¸¸é‡ç­‰ä¸åº”ç”±ç”¨æˆ·ä¿®æ”¹çš„é…ç½®

## ä¸»è¦å˜æ›´

### 1. åˆ›å»ºç±»å‹å®šä¹‰

**æ–‡ä»¶**: `src/renderer/src/typings/settingTypes.ts`

æ–°å¢è®¾ç½®ç›¸å…³ç±»å‹å®šä¹‰æ–‡ä»¶ï¼Œå®šä¹‰äº†é€šç”¨çš„è®¾ç½®é…ç½®å’Œè®¾ç½®é¡¹æ¥å£ï¼š

```typescript
/** è®¾ç½®é…ç½®æ¥å£ - JSONé…ç½®é©±åŠ¨ç”Ÿæˆè®¾ç½®ç»„ä»¶ */
export type SettingConfig = {
  name: string;
  title: string;
  description: string;
  type:
    | "input"
    | "select"
    | "checkbox"
    | "radio"
    | "textarea"
    | "number"
    | "date"
    | "time"
    | "datetime"
    | "file"
    | "image"
    | "video"
    | "audio"
    | "url"
    | "email"
    | "password"
    | "tel"
    | "search"
    | "range"
    | "color"
    | "hidden";
  defaultValue?: (() => any) | any;
  required?: boolean;
  option?: any;
  children?: SettingConfig[];
};

/** é€šç”¨è®¾ç½®é¡¹æ¥å£ */
export interface SettingItem {
  id: string;
  name: string;
  icon?: string;
  description?: string;
  settings: SettingConfig[];
  type: "app" | "plugin";
}
```

**ä¸»è¦å˜æ›´**ï¼š

- å°† `SettingConfig` ä» `pluginTypes.ts` ç§»è‡³ `settingTypes.ts`
- `pluginTypes.ts` ä¸­é‡æ–°å¯¼å‡º `SettingConfig` ä»¥ä¿æŒå‘åå…¼å®¹
- è¯¥ç±»å‹ç»Ÿä¸€ç”¨äºåº”ç”¨è®¾ç½®å’Œæ’ä»¶è®¾ç½®ï¼Œå¹¶åœ¨ `src/renderer/src/typings/index.ts` ä¸­å¯¼å‡º

### 2. åˆ›å»ºåº”ç”¨è®¾ç½®é…ç½®æ–‡ä»¶

**æ–‡ä»¶**: `src/renderer/src/config/appSettings.ts`

æ–°å¢äº†åº”ç”¨ç¨‹åºè®¾ç½®é…ç½®æ–‡ä»¶ï¼ŒåŒ…å«ä»¥ä¸‹è®¾ç½®é¡¹ï¼š

- **ç³»ç»Ÿè®¾ç½®** (`app`): autoStart, alwaysOnTop, language, theme, logLevel

**é‡è¦è¯´æ˜**ï¼š

- é…ç½®ä¸­çš„ `name` å­—æ®µå¿…é¡»ä¸ `AppConfig` æ¥å£ä¸­çš„å­—æ®µåä¸€è‡´
- è®¾ç½®é¡¹ä¼šç›´æ¥è¯»å†™ `AppConfig` å¯¹åº”çš„å­—æ®µï¼Œæ— éœ€é¢å¤–çš„å­˜å‚¨å±‚
- é…ç½®ç±»å‹ä½¿ç”¨ `Omit<SettingItem, 'type'>[]`ï¼Œçœç•¥ `type` å­—æ®µï¼ˆåœ¨åŠ è½½æ—¶åŠ¨æ€æ·»åŠ ï¼‰

### 3. é‡å‘½åå’Œé‡æ„è®¾ç½®ç»„ä»¶

**å˜æ›´å†…å®¹**:

- æ–‡ä»¶å¤¹ä» `views/PluginSettings` é‡å‘½åä¸º `views/Settings`
- ç»„ä»¶æ¥å£ä»å±€éƒ¨å®šä¹‰æ”¹ä¸ºä½¿ç”¨ç»Ÿä¸€çš„ `SettingItem` ç±»å‹ï¼ˆå®šä¹‰åœ¨ `@/typings/settingTypes.ts`ï¼‰
- æ·»åŠ  `type` å­—æ®µåŒºåˆ†åº”ç”¨è®¾ç½® (`app`) å’Œæ’ä»¶è®¾ç½® (`plugin`)
- ç»„ä»¶åä» `SettingItem` æ”¹ä¸º `SettingItemComponent` ä»¥é¿å…ä¸ç±»å‹åå†²çª

### 4. æ›´æ–°è®¾ç½®é¡µé¢é€»è¾‘

**æ–‡ä»¶**: `src/renderer/src/views/Settings/index.vue`

**ä¸»è¦å˜æ›´**:

- åŠ è½½åº”ç”¨è®¾ç½®å’Œæ’ä»¶è®¾ç½®çš„ç»Ÿä¸€å…¥å£ `getAllSettings()`
- **åº”ç”¨è®¾ç½®ç›´æ¥è¯»å†™ `AppConfig` å¯¹åº”å­—æ®µ**ï¼Œæ— éœ€ `appSettings` ä¸­é—´å±‚
- æ’ä»¶è®¾ç½®å­˜å‚¨åœ¨ `pluginSettings`
- ä¿å­˜åŠŸèƒ½ï¼šåº”ç”¨è®¾ç½®é€å­—æ®µä¿å­˜åˆ° `AppConfig`ï¼Œæ’ä»¶è®¾ç½®æ‰¹é‡ä¿å­˜
- é‡ç½®åŠŸèƒ½ï¼šåº”ç”¨è®¾ç½®åˆ é™¤ `AppConfig` å¯¹åº”å­—æ®µä»¥æ¢å¤é»˜è®¤å€¼

**æ ¸å¿ƒæ–¹æ³•**:

```typescript
// è·å–æ‰€æœ‰è®¾ç½®ï¼ˆåº”ç”¨è®¾ç½® + æ’ä»¶è®¾ç½®ï¼‰
const getAllSettings = async () => {
  // 1. åŠ è½½åº”ç”¨è®¾ç½® - ä» AppConfig è¯»å–å¯¹åº”å­—æ®µ
  for (const appSetting of appSettingsConfig) {
    for (const setting of appSetting.settings) {
      const savedValue = await storeUtils.get(setting.name as any);
      settingValues[appSetting.id][setting.name] =
        savedValue ?? getDefaultValue(setting);
    }
  }

  // 2. åŠ è½½æ’ä»¶è®¾ç½®
  const savedPluginSettings = (await storeUtils.get("pluginSettings")) || {};
  // ... åˆå§‹åŒ–æ’ä»¶è®¾ç½®
};

// ä¿å­˜æ‰€æœ‰è®¾ç½®
const saveAllSettings = async () => {
  // 1. ä¿å­˜åº”ç”¨è®¾ç½® - ç›´æ¥è®¾ç½®åˆ° AppConfig å¯¹åº”å­—æ®µ
  for (const settingGroup of settingsList) {
    if (settingGroup.type === "app") {
      for (const setting of settingGroup.settings) {
        await storeUtils.set(setting.name as any, value);
      }
    }
  }

  // 2. ä¿å­˜æ’ä»¶è®¾ç½®
  await storeUtils.set("pluginSettings", pluginSettings);
};

// é‡ç½®æ‰€æœ‰è®¾ç½®
const resetAllSettings = async () => {
  // åº”ç”¨è®¾ç½®ï¼šåˆ é™¤ AppConfig å¯¹åº”å­—æ®µ
  if (settingGroup.type === "app") {
    await storeUtils.delete(setting.name as any);
  }

  // æ’ä»¶è®¾ç½®ï¼šæ¸…ç©ºå­˜å‚¨
  await storeUtils.set("pluginSettings", {});
};
```

### 5. æ›´æ–°è®¾ç½®é¡¹ç»„ä»¶

**æ–‡ä»¶**: `src/renderer/src/views/Settings/SettingItem.vue`

**å˜æ›´å†…å®¹**:

- Props ä» `pluginId` æ”¹ä¸ºæ›´é€šç”¨çš„ `settingId`
- å®Œå–„ `range` ç±»å‹è®¾ç½®é¡¹çš„é€‰é¡¹è¯»å–ï¼š
  - `min`: æœ€å°å€¼ï¼ˆé»˜è®¤ 0ï¼‰
  - `max`: æœ€å¤§å€¼ï¼ˆé»˜è®¤ 100ï¼‰
  - `step`: æ­¥é•¿ï¼ˆé»˜è®¤ 1ï¼‰

### 6. ç±»å‹ç³»ç»Ÿæ›´æ–°

**æ–‡ä»¶**: `src/shared/typings/appTypes.ts`

åˆ é™¤äº† `appSettings` å­—æ®µï¼Œåº”ç”¨è®¾ç½®ç›´æ¥ä½¿ç”¨ `AppConfig` çš„ç°æœ‰å­—æ®µï¼š

```typescript
export interface AppConfig {
  theme: "light" | "dark"; // ä¸»é¢˜è®¾ç½®
  language: string; // è¯­è¨€è®¾ç½®
  logLevel: "error" | "warn" | "info" | "debug"; // æ—¥å¿—çº§åˆ«
  autoStart?: boolean; // å¼€æœºè‡ªå¯
  alwaysOnTop?: boolean; // çª—å£ç½®é¡¶
  // ... å…¶ä»–å­—æ®µ
  /** æ’ä»¶è®¾ç½®å­˜å‚¨ */
  pluginSettings?: Record<string, Record<string, any>>;
}
```

**æ–‡ä»¶**: `src/renderer/src/typings/settingTypes.ts` å’Œ `src/renderer/src/typings/pluginTypes.ts`

- å°† `SettingConfig` ç±»å‹ä» `pluginTypes.ts` ç§»è‡³ `settingTypes.ts`
- åœ¨ `pluginTypes.ts` ä¸­å¯¼å…¥ä½¿ç”¨ï¼ˆä¸å†é‡æ–°å¯¼å‡ºï¼‰ï¼š
  ```typescript
  import type { SettingConfig } from './settingTypes'
  // åœ¨ PluginConfig æ¥å£ä¸­ä½¿ç”¨
  settings?: SettingConfig[]
  ```

### 7. è·¯ç”±æ›´æ–°

**æ–‡ä»¶**: `src/renderer/src/pages/settings/router.ts`

æ›´æ–°è®¾ç½®é¡µé¢è·¯ç”±ï¼š

```typescript
{
  path: "/settings",              // ä» /plugin-settings æ”¹ä¸º /settings
  name: "settings",               // ä» plugin-settings æ”¹ä¸º settings
  component: () => import("@/views/Settings/index.vue"),  // æ›´æ–°è·¯å¾„
  meta: {
    title: "è®¾ç½®",
    description: "é…ç½®åº”ç”¨ç¨‹åºå’Œæ’ä»¶çš„ä¸ªæ€§åŒ–è®¾ç½®",  // æ›´æ–°æè¿°
    icon: "mdi:settings",
    keepAlive: true,
  },
}
```

## ä½¿ç”¨æ–¹å¼

### æ·»åŠ æ–°çš„åº”ç”¨è®¾ç½®

åœ¨ `src/renderer/src/config/appSettings.ts` ä¸­æ·»åŠ æ–°çš„è®¾ç½®ç»„æˆ–è®¾ç½®é¡¹ï¼š

```typescript
import type { SettingItem } from "@/typings";

export const appSettingsConfig: Omit<SettingItem, "type">[] = [
  // ... ç°æœ‰è®¾ç½®ç»„
  {
    id: "new-group",
    name: "æ–°è®¾ç½®ç»„",
    icon: "ğŸ¯",
    description: "è¿™æ˜¯ä¸€ä¸ªæ–°çš„è®¾ç½®ç»„",
    settings: [
      {
        name: "newSetting",
        title: "æ–°è®¾ç½®",
        description: "è¿™æ˜¯ä¸€ä¸ªæ–°è®¾ç½®çš„æè¿°",
        type: "checkbox",
        defaultValue: false,
      },
      // ... æ›´å¤šè®¾ç½®é¡¹
    ],
  },
];
```

æ³¨æ„ï¼šé…ç½®ä¸­ä¸éœ€è¦æ˜¾å¼æŒ‡å®š `type` å­—æ®µï¼Œå®ƒä¼šåœ¨åŠ è½½æ—¶è‡ªåŠ¨æ·»åŠ ä¸º `'app'`ã€‚

### æ”¯æŒçš„è®¾ç½®ç±»å‹

- `input`: æ–‡æœ¬è¾“å…¥æ¡†
- `password`: å¯†ç è¾“å…¥æ¡†
- `textarea`: æ–‡æœ¬åŸŸ
- `number`: æ•°å­—è¾“å…¥
- `checkbox`: å¤é€‰æ¡†
- `select`: ä¸‹æ‹‰é€‰æ‹©ï¼ˆéœ€é…ç½® `option.options`ï¼‰
- `color`: é¢œè‰²é€‰æ‹©å™¨
- `range`: èŒƒå›´æ»‘å—ï¼ˆéœ€é…ç½® `option.min/max/step`ï¼‰
- `file`: æ–‡ä»¶é€‰æ‹©

### è¯»å–è®¾ç½®å€¼

```typescript
import { storeUtils } from "@/core/utils/store";

// è¯»å–åº”ç”¨è®¾ç½® - ç›´æ¥è¯»å– AppConfig å­—æ®µ
const autoStart = await storeUtils.get("autoStart");
const theme = await storeUtils.get("theme");
const language = await storeUtils.get("language");

// è¯»å–æ’ä»¶è®¾ç½®
const pluginSettings = await storeUtils.get("pluginSettings");
const specificPluginSettings = pluginSettings?.["plugin-id"];
```

## å­˜å‚¨ç»“æ„

è®¾ç½®æ•°æ®å­˜å‚¨åœ¨æœ¬åœ°å­˜å‚¨ä¸­ï¼Œç»“æ„å¦‚ä¸‹ï¼š

```typescript
{
  // åº”ç”¨è®¾ç½® - ç›´æ¥å­˜å‚¨åœ¨ AppConfig é¡¶å±‚
  autoStart: false,
  language: "zh-CN",
  theme: "light",
  logLevel: "info",
  alwaysOnTop: false,

  // æ’ä»¶è®¾ç½® - ä½¿ç”¨ä¸“é—¨çš„å­˜å‚¨é”®
  pluginSettings: {
    "plugin-id-1": {
      setting1: "value1",
      setting2: "value2"
    },
    "plugin-id-2": {
      // ... æ’ä»¶è®¾ç½®
    }
  },

  // è¿è¡Œæ—¶æ•°æ®ï¼ˆä¸åœ¨è®¾ç½®é¡µé¢ä¸­é…ç½®ï¼‰
  recentApps: [...],
  pinnedApps: [...],
  fileList: [...],
  installedPlugins: [...],
  hotkeys: {...},
  customHotkeys: [...]
}
```

## æ³¨æ„äº‹é¡¹

1. **é»˜è®¤å€¼å¤„ç†**: è®¾ç½®é¡¹çš„ `defaultValue` å¯ä»¥æ˜¯å€¼æˆ–å‡½æ•°ï¼Œå‡½æ•°ä¼šåœ¨åˆå§‹åŒ–æ—¶æ‰§è¡Œ
2. **ç±»å‹å®‰å…¨**: ä½¿ç”¨ TypeScript ç¡®ä¿ç±»å‹å®‰å…¨ï¼Œé¿å…è¿è¡Œæ—¶é”™è¯¯
3. **å­˜å‚¨ç»“æ„**:
   - åº”ç”¨è®¾ç½®ç›´æ¥æ˜ å°„åˆ° `AppConfig` å­—æ®µï¼Œæ— ä¸­é—´å±‚
   - æ’ä»¶è®¾ç½®ä½¿ç”¨ç‹¬ç«‹çš„ `pluginSettings` å­˜å‚¨
4. **å­—æ®µå‘½å**: åº”ç”¨è®¾ç½®çš„ `name` å¿…é¡»ä¸ `AppConfig` æ¥å£å­—æ®µåä¸€è‡´
5. **ç¼“å­˜ç­–ç•¥**: `storeUtils` å†…éƒ¨å®ç°äº†ç¼“å­˜æœºåˆ¶ï¼Œæé«˜è¯»å–æ€§èƒ½
6. **é…ç½®èŒƒå›´**: åªé…ç½®é€‚åˆåœ¨è®¾ç½®é¡µé¢ä¿®æ”¹çš„å­—æ®µï¼Œæ’é™¤è¿è¡Œæ—¶æ•°æ®å’Œæœ‰ä¸“é—¨ç®¡ç†é¡µé¢çš„é…ç½®

## æœªæ¥æ‰©å±•

- [ ] æ·»åŠ è®¾ç½®é¡¹éªŒè¯åŠŸèƒ½
- [ ] æ”¯æŒè®¾ç½®é¡¹çš„æ¡ä»¶æ˜¾ç¤º/éšè—
- [ ] æ·»åŠ è®¾ç½®å¯¼å…¥/å¯¼å‡ºåŠŸèƒ½
- [ ] æ”¯æŒè®¾ç½®æœç´¢åŠŸèƒ½
- [ ] æ·»åŠ è®¾ç½®å˜æ›´å†å²è®°å½•
