# 设置页面路由化改造说明

## 概述

将设置页面从传统的组件切换方式改造为基于 Vue Router 的单页应用架构，并实现了页面缓存功能。同时将所有页面统一迁移到 `views/` 目录，采用标准的目录结构组织代码。

## 改造内容

### 1. 新增 Views 目录结构

**目录**: `src/renderer/src/views/`

采用标准的 Vue 项目结构，所有页面统一放在 `views/` 目录下：

```
views/
├── Plugins/              # 插件管理页面
│   └── index.vue
├── PluginSettings/       # 插件设置页面
│   └── index.vue
├── Hotkeys/              # 快捷键设置页面
│   ├── hooks/
│   │   └── useHotkeyListener.ts
│   └── index.vue
├── CustomHotkeys/        # 自定义快捷键页面
│   ├── hooks/
│   │   └── useHotkeyListener.ts
│   └── index.vue
├── Downloads/            # 下载管理页面
│   └── index.vue
└── About/                # 关于页面
    └── index.vue
```

**目录规范**：

- 每个页面独立一个目录
- 主组件统一命名为 `index.vue`
- hooks 放在对应页面目录的 `hooks/` 子目录中
- 与写组件的方式保持一致

### 2. 新增路由配置文件

**文件**: `src/renderer/src/pages/settings/router.ts`

- 使用 `createWebHashHistory` 创建路由历史管理
- 配置了 6 个设置页面路由：
  - `/plugins` - 插件管理 → `@/views/Plugins/index.vue`
  - `/plugin-settings` - 插件设置 → `@/views/PluginSettings/index.vue`
  - `/hotkeys` - 快捷键设置 → `@/views/Hotkeys/index.vue`
  - `/custom` - 自定义快捷键 → `@/views/CustomHotkeys/index.vue`
  - `/downloads` - 下载管理 → `@/views/Downloads/index.vue`
  - `/about` - 关于页面 → `@/views/About/index.vue`

- 所有路由组件采用懒加载方式（`() => import(...)`）
- 每个路由都配置了 `meta` 信息：
  - `title` - 页面标题
  - `description` - 页面描述
  - `icon` - 图标标识
  - `keepAlive: true` - 启用页面缓存

### 3. 修改主应用组件

**文件**: `src/renderer/src/pages/settings/App.vue`

#### 模板变更

- **左侧菜单**：从 `button` + `v-for` 改为 `router-link` + 自定义渲染
  - 使用 `router-link` 的 `custom` 模式和作用域插槽
  - 通过 `isActive` 自动高亮当前路由
  - 调用 `navigate` 进行路由跳转

- **右侧内容区**：从 `component :is` 动态组件改为 `router-view`
  - 使用 `router-view` 的作用域插槽获取组件
  - 包裹 `<keep-alive>` 实现页面缓存
  - 页面切换时保留组件状态和数据

- **头部信息**：从本地状态获取改为从路由 meta 获取
  - `currentRoute.meta.title` - 显示当前页面标题
  - `currentRoute.meta.description` - 显示当前页面描述

#### 脚本变更

- 移除了原有的 `tabsConfig` 配置数组
- 移除了 `activeTab` 状态管理
- 移除了组件直接导入（改为路由懒加载）
- 引入 `useRouter` 和 `useRoute` hooks
- 通过 `router.getRoutes()` 动态获取路由列表
- 添加 `iconMap` 和 `getIcon` 函数处理图标映射

### 4. 修改应用入口

**文件**: `src/renderer/src/pages/settings/main.ts`

- 引入路由配置 `import router from './router'`
- 注册路由插件 `app.use(router)`

## 核心特性

### 1. 页面缓存 (Keep-Alive)

通过 `<keep-alive>` 组件包裹 `<router-view>`，实现以下效果：

- 页面切换时保留组件状态
- 避免重复渲染和数据重新加载
- 提升用户体验和性能

**使用示例**：

```vue
<router-view v-slot="{ Component }">
  <keep-alive>
    <component :is="Component" />
  </keep-alive>
</router-view>
```

### 2. 懒加载

所有路由组件采用动态导入：

```typescript
component: () => import("@/components/Plugins/PluginManager.vue");
```

优势：

- 减少初始加载体积
- 按需加载页面资源
- 提升应用启动速度

### 3. 路由元信息

每个路由都配置了丰富的 meta 信息：

```typescript
meta: {
  title: '插件管理',
  description: '管理插件，扩展应用程序功能',
  icon: 'mdi:puzzle',
  keepAlive: true,
}
```

可用于：

- 动态显示页面标题和描述
- 菜单自动生成
- 路由权限控制（未来扩展）

## 路由配置说明

### Hash 模式

使用 `createWebHashHistory()` 创建路由：

- URL 格式：`#/plugins`、`#/hotkeys` 等
- 兼容 Electron 环境
- 无需服务器配置

### 默认路由

配置了根路径重定向：

```typescript
{
  path: '/',
  redirect: '/plugins',
}
```

首次访问自动跳转到插件管理页面。

## Views vs Components

### 目录职责划分

- **views/** - 页面级组件
  - 由路由直接渲染的页面组件
  - 包含完整的业务逻辑
  - 可以有自己的 hooks、utils 等辅助文件
  - 命名为 `index.vue`

- **components/** - 公共组件
  - 可复用的 UI 组件
  - 通用的业务组件
  - 不直接与路由关联
  - 可在多个页面中使用

### 示例

```
src/renderer/src/
├── views/                    # 页面级组件（路由页面）
│   ├── Plugins/
│   │   └── index.vue         # 插件管理页面
│   └── Hotkeys/
│       ├── hooks/            # 页面专用 hooks
│       └── index.vue         # 快捷键设置页面
│
└── components/               # 公共组件
    ├── Plugins/
    │   ├── PluginCard.vue    # 插件卡片（可复用）
    │   └── PluginDetail.vue  # 插件详情（可复用）
    └── Common/
        └── IconDisplay.vue   # 图标显示（通用组件）
```

## 开发建议

### 1. 添加新页面

**步骤 1**: 在 `views/` 目录创建新页面目录和文件：

```bash
views/
└── NewPage/
    ├── hooks/              # 如果需要 hooks
    │   └── useNewPage.ts
    └── index.vue           # 主组件
```

**步骤 2**: 在 `router.ts` 中添加新路由：

```typescript
{
  path: '/new-page',
  name: 'new-page',
  component: () => import('@/views/NewPage/index.vue'),
  meta: {
    title: '新页面',
    description: '这是一个新页面',
    icon: 'mdi:new-icon',
    keepAlive: true,
  },
}
```

### 2. 控制缓存

如果某个页面不需要缓存，可以：

- 设置 `meta.keepAlive: false`
- 或使用 `include/exclude` 属性控制 keep-alive：

```vue
<keep-alive :exclude="['NoCache']">
  <component :is="Component" />
</keep-alive>
```

### 3. 访问路由信息

在组件中使用路由：

```typescript
import { useRoute, useRouter } from "vue-router";

const route = useRoute();
const router = useRouter();

// 获取当前路由信息
console.log(route.path, route.meta);

// 编程式导航
router.push("/plugins");
```

## 优势总结

1. **标准化目录结构**：采用 Vue 项目最佳实践，views 统一管理页面级组件
2. **更好的架构**：符合 Vue 生态最佳实践，职责清晰
3. **页面缓存**：提升性能和用户体验
4. **灵活扩展**：易于添加新页面和功能
5. **代码分割**：懒加载减少初始加载时间
6. **类型安全**：完整的 TypeScript 支持
7. **维护性强**：路由配置集中管理，代码组织清晰
8. **统一规范**：每个页面 `index.vue` + `hooks/` 的结构便于理解和维护

## 注意事项

1. **组件生命周期**：使用 keep-alive 后，组件的 `created` 和 `mounted` 只会在首次渲染时调用，后续切换会触发 `activated` 和 `deactivated`
2. **状态管理**：缓存的组件状态会保留，注意数据更新逻辑
3. **内存占用**：所有访问过的页面都会保留在内存中，必要时可以使用 `include/exclude` 控制

## 后续优化建议

1. 添加路由过渡动画
2. 实现路由权限控制
3. 添加面包屑导航
4. 支持浏览器前进/后退
5. 添加页面加载状态指示
