# 项目概览

## 项目简介

这是一个基于 Electron + Vue 3 + TypeScript 的现代化桌面应用开发模板，集成了完整的开发工具链和最佳实践。项目采用模块化架构设计，提供了类型安全的 IPC 通信、统一的日志系统、数据存储解决方案和完整的调试环境。

## 技术栈

### 核心技术

- **Electron**: 跨平台桌面应用框架
- **Vue 3**: 渐进式 JavaScript 框架
- **TypeScript**: 类型安全的 JavaScript 超集
- **Vite**: 快速的前端构建工具

### 开发工具

- **Electron Forge**: 应用打包和分发工具
- **ts-morph**: TypeScript 代码分析和生成工具
- **electron-log**: 统一的日志记录系统
- **electron-store**: 数据持久化存储

### 开发环境

- **VS Code**: 推荐的代码编辑器
- **pnpm**: 高效的包管理器
- **ESLint**: 代码质量检查工具

## 项目结构

```
naimo/
├── docs/                    # 项目文档
│   ├── 项目概览.md
│   ├── IPC配置.md
│   ├── 日志和Store.md
│   └── 调试.md
├── src/                     # 源代码
│   ├── main/               # 主进程代码
│   │   ├── config/         # 配置文件
│   │   ├── ipc-router/     # IPC 路由系统
│   │   │   ├── core.ts     # 核心路由逻辑
│   │   │   ├── index.ts    # 路由初始化
│   │   │   └── modules/    # 路由模块
│   │   │       ├── app.ts
│   │   │       ├── filesystem.ts
│   │   │       ├── log.ts
│   │   │       ├── store.ts
│   │   │       └── window.ts
│   │   ├── preloads/       # 预加载脚本
│   │   │   └── basic.ts
│   │   ├── services/       # 服务层
│   │   └── main.ts         # 主进程入口
│   ├── renderer/           # 渲染进程代码
│   │   ├── src/           # Vue 应用源码
│   │   │   ├── components/ # Vue 组件
│   │   │   ├── views/     # 页面视图
│   │   │   ├── store/     # 状态管理
│   │   │   ├── routers/   # 路由配置
│   │   │   └── App.vue    # 根组件
│   │   └── public/        # 静态资源
│   └── shared/            # 共享代码
│       ├── typings/       # 类型定义
│       │   ├── global.d.ts
│       │   └── ipc-routes.ts
│       ├── types.ts       # 共享类型
│       ├── utils.ts       # 工具函数
│       └── ipc-router-client.ts # IPC 客户端
├── scripts/               # 构建脚本
│   ├── dev.js            # 开发环境启动
│   ├── build.js          # 生产环境构建
│   └── generate-ipc-types.js # IPC 类型生成
├── setup/                # 安装包配置
├── dist/                 # 构建输出
└── package.json          # 项目配置
```

## 核心特性

### 1. 类型安全的 IPC 通信

- **自动化类型生成**: 基于 TypeScript 源码自动生成 IPC 类型定义
- **双重命名支持**: 同时支持驼峰式和短横线式命名
- **完整的类型推导**: 参数和返回值类型自动推导
- **智能代码提示**: VS Code 完整的智能提示支持

```typescript
// 使用示例
const appName = await api.ipcRouter.appGetName();
const systemInfo = await api.ipcRouter.appGetSystemInfo();
```

### 2. 统一的日志系统

- **多进程支持**: 主进程、渲染进程、预加载脚本统一日志接口
- **自动错误捕获**: 全局错误处理和日志记录
- **日志轮转**: 自动管理日志文件大小
- **多种输出格式**: 支持控制台、文件等多种输出方式

```typescript
// 主进程
import log from "electron-log";
log.info("应用启动成功");

// 渲染进程
api.log.info("用户操作", { action: "click" });
```

### 3. 数据存储解决方案

- **类型安全存储**: 基于 TypeScript 的类型安全数据存储
- **跨进程访问**: 主进程和渲染进程都可以访问存储数据
- **配置管理**: 统一的配置管理和验证
- **数据持久化**: 自动数据持久化和恢复

```typescript
// 设置数据
await api.ipcRouter.storeSet("user.name", "John Doe");

// 获取数据
const userName = await api.ipcRouter.storeGet("user.name");
```

### 4. 完整的调试环境

- **多进程调试**: 支持主进程、渲染进程、预加载脚本调试
- **VS Code 集成**: 完整的 VS Code 调试配置
- **断点调试**: 支持条件断点、日志断点等高级调试功能
- **性能分析**: 集成性能分析和内存泄漏检测工具

### 5. 现代化开发体验

- **热重载**: 开发时自动重载，提高开发效率
- **TypeScript 支持**: 完整的 TypeScript 类型检查
- **代码质量**: ESLint 代码质量检查
- **自动化构建**: 一键构建和打包

## 快速开始

### 环境要求

- Node.js >= 18.0.0
- pnpm >= 8.0.0
- VS Code (推荐)

### 安装依赖

```bash
# 克隆项目
git clone <repository-url>
cd naimo

# 安装依赖
pnpm install
```

### 开发模式

```bash
# 启动开发环境
pnpm dev

# 或者使用 VS Code 调试
# 按 F5 启动调试会话
```

### 构建应用

```bash
# 构建应用
pnpm build

# 打包应用
pnpm make

# 创建安装包
pnpm build:nsis-win64
```

## 开发指南

### 1. 添加新的 IPC 路由

1. 在 `src/main/ipc-router/modules/` 下创建或编辑模块文件
2. 导出带注释和类型注解的函数
3. 运行 `pnpm generate:ipc-types` 重新生成类型
4. 在渲染进程中使用 `api.ipcRouter` 调用

### 2. 添加新的 Vue 组件

1. 在 `src/renderer/src/components/` 下创建组件文件
2. 使用 TypeScript 和 Composition API
3. 在需要的地方导入和使用组件

### 3. 配置应用设置

1. 在 `src/shared/types.ts` 中定义配置类型
2. 在 `src/main/config/` 下添加配置文件
3. 使用 `api.ipcRouter.storeSet/get` 管理配置

### 4. 添加新的服务

1. 在 `src/main/services/` 下创建服务文件
2. 在 IPC 路由中调用服务方法
3. 通过 IPC 暴露给渲染进程

## 最佳实践

### 1. 代码组织

- 按功能模块组织代码
- 使用 TypeScript 严格模式
- 遵循 ESLint 规则
- 编写清晰的注释和文档

### 2. 错误处理

- 使用 try-catch 包装可能出错的代码
- 记录详细的错误日志
- 提供用户友好的错误提示
- 实现适当的错误恢复机制

### 3. 性能优化

- 避免频繁的 IPC 调用
- 使用缓存减少重复计算
- 优化渲染性能
- 监控内存使用情况

### 4. 安全性

- 验证所有用户输入
- 使用 contextBridge 安全地暴露 API
- 避免在主进程中执行不可信代码
- 定期更新依赖包

## 部署和分发

### 1. 构建配置

项目使用 Electron Forge 进行构建和打包：

```json
{
  "config": {
    "forge": {
      "packagerConfig": {
        "asar": true,
        "icon": "./setup/exe.ico"
      },
      "makers": [
        {
          "name": "@electron-forge/maker-squirrel",
          "config": {
            "name": "electron_app"
          }
        }
      ]
    }
  }
}
```

### 2. 安装包制作

项目支持创建 Windows 安装包：

```bash
# 创建 NSIS 安装包
pnpm build:nsis-win64
```

### 3. 自动更新

集成了 `update-electron-app` 支持自动更新：

```typescript
import { autoUpdater } from "update-electron-app";

// 配置自动更新
autoUpdater({
  repo: "your-username/your-repo",
  updateInterval: "1 hour",
});
```

## 常见问题

### Q: 如何添加新的依赖包？

A: 使用 pnpm 添加依赖：

```bash
# 生产依赖
pnpm add package-name

# 开发依赖
pnpm add -D package-name
```

### Q: 如何配置不同的构建环境？

A: 在 `package.json` 中配置不同的脚本，或使用环境变量。

### Q: 如何处理跨平台兼容性？

A: 使用 Electron 的跨平台 API，避免使用平台特定的代码。

### Q: 如何优化应用启动速度？

A:

1. 延迟加载非关键模块
2. 使用代码分割
3. 优化预加载脚本
4. 减少主进程初始化时间

## 贡献指南

1. Fork 项目
2. 创建功能分支
3. 提交更改
4. 推送到分支
5. 创建 Pull Request

## 许可证

MIT License

## 联系方式

如有问题或建议，请通过以下方式联系：

- 创建 Issue
- 发送邮件
- 提交 Pull Request
