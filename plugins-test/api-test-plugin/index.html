<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Naimo API 测试面板</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
        "Helvetica Neue", Arial, "Microsoft YaHei", sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      padding: 20px;
      min-height: 100vh;
    }

    body {
      height: 100vh;
      overflow: hidden;
    }

    .container {
      background: white;
      border-radius: 16px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
      padding: 30px;
      max-width: 1200px;
      margin: 0 auto;
      height: 100%;
      overflow: auto;
    }

    h1 {
      color: #333;
      margin-bottom: 10px;
      font-size: 28px;
    }

    .subtitle {
      color: #666;
      margin-bottom: 30px;
      font-size: 14px;
    }

    .api-section {
      margin-bottom: 30px;
      padding: 20px;
      background: #f8f9fa;
      border-radius: 12px;
      border-left: 4px solid #667eea;
    }

    .api-section h2 {
      color: #333;
      margin-bottom: 15px;
      font-size: 20px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .api-section h2 .icon {
      font-size: 24px;
    }

    .button-group {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 15px;
    }

    button {
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      background: #667eea;
      color: white;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      white-space: nowrap;
    }

    button:hover {
      background: #5568d3;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
    }

    button:active {
      transform: translateY(0);
    }

    button.secondary {
      background: #6c757d;
    }

    button.secondary:hover {
      background: #5a6268;
    }

    button.danger {
      background: #dc3545;
    }

    button.danger:hover {
      background: #c82333;
    }

    .input-group {
      display: flex;
      gap: 10px;
      margin-bottom: 15px;
      align-items: center;
    }

    input[type="text"],
    input[type="number"],
    textarea {
      flex: 1;
      padding: 8px 12px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 13px;
      font-family: inherit;
    }

    textarea {
      min-height: 60px;
      resize: vertical;
    }

    .output {
      background: #fff;
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 15px;
      margin-top: 10px;
      font-family: "Courier New", monospace;
      font-size: 12px;
      max-height: 200px;
      overflow-y: auto;
      white-space: pre-wrap;
      word-break: break-all;
    }

    .output.success {
      border-color: #28a745;
      background: #f0fff4;
    }

    .output.error {
      border-color: #dc3545;
      background: #fff5f5;
      color: #dc3545;
    }

    .divider {
      height: 1px;
      background: #ddd;
      margin: 20px 0;
    }

    .info-box {
      background: #e7f3ff;
      border-left: 4px solid #2196f3;
      padding: 12px;
      border-radius: 6px;
      margin-bottom: 15px;
      font-size: 13px;
      color: #0066cc;
    }
  </style>
</head>

<body>
  <div class="container">
    <h1>🧪 Naimo API 测试面板</h1>
    <p class="subtitle">测试所有可用的 Naimo API 功能 - P0 核心 API 已全部实现</p>

    <!-- 综合使用说明 -->
    <div class="api-section" style="background: linear-gradient(135deg, #667eea22 0%, #764ba222 100%);">
      <h2><span class="icon">📘</span>API 使用指南</h2>
      <div class="info-box">
        <strong>🎯 第二阶段（P0核心API）已完成：</strong><br>
        ✅ 窗口管理 (window) - 隐藏/显示/关闭窗口<br>
        ✅ 文档数据库 (db) - 基于 lowdb 的文档存储，支持版本控制<br>
        ✅ 键值存储 (storage) - 简单的配置存储<br>
        ✅ 剪贴板 (clipboard) - 读写文本和图片<br>
        ✅ Shell操作 (shell) - 打开文件/URL/文件夹<br>
        ✅ 系统信息 (system) - 获取版本、路径、设备ID等<br>
        ✅ 屏幕显示 (screen) - 截图、显示器信息<br>
        ✅ 对话框 (dialog) - 文件选择、保存对话框<br>
        ✅ 输入模拟 (input) - 粘贴文本/图片/文件
      </div>
      <div class="info-box" style="background: #e7f3ff; border-color: #2196f3;">
        <strong>💡 快速开始：</strong><br>
        1️⃣ 点击各模块的按钮测试基础功能<br>
        2️⃣ 查看带有 <span style="color: #28a745;">绿色</span>/<span style="color: #17a2b8;">蓝色</span>/<span
          style="color: #6f42c1;">紫色</span> 按钮的实用案例<br>
        3️⃣ 在控制台查看详细的API调用日志<br>
        4️⃣ 参考实用案例的源代码了解最佳实践
      </div>
      <div class="button-group">
        <button onclick="runComprehensiveExample()"
          style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); font-size: 15px; padding: 12px 24px;">
          🚀 运行综合示例
        </button>
        <button onclick="showApiDocs()" style="background: #17a2b8; font-size: 15px; padding: 12px 24px;">
          📚 查看API文档
        </button>
      </div>
      <div id="comprehensiveOutput" class="output" style="display: none;"></div>
    </div>

    <!-- ========== 日志 API ========== -->
    <div class="api-section">
      <h2><span class="icon">📝</span>日志系统 (log)</h2>
      <div class="button-group">
        <button onclick="testLogError()">log.error</button>
        <button onclick="testLogWarn()">log.warn</button>
        <button onclick="testLogInfo()">log.info</button>
        <button onclick="testLogDebug()">log.debug</button>
        <button onclick="testLogThrowError()">log.throw_error</button>
      </div>
      <div id="logOutput" class="output"></div>
    </div>

    <!-- ========== 窗口管理 API ========== -->
    <div class="api-section">
      <h2><span class="icon">🪟</span>窗口管理 (window)</h2>
      <div class="button-group">
        <button onclick="testWindowHide()">hide</button>
        <button onclick="testWindowShow()">show</button>
        <button onclick="testWindowMinimize()">minimize</button>
        <button onclick="testWindowMaximize()">maximize</button>
        <button class="danger" onclick="testWindowClose()">close</button>
      </div>
      <div class="input-group">
        <input type="number" id="windowHeight" placeholder="高度 (px)" value="600" />
        <button onclick="testWindowSetHeight()">设置高度</button>
      </div>
      <div class="input-group">
        <input type="number" id="windowWidth" placeholder="宽度 (px)" value="800" />
        <input type="number" id="windowHeightForSize" placeholder="高度 (px)" value="600" />
        <button onclick="testWindowSetSize()">设置尺寸</button>
      </div>
      <div id="windowOutput" class="output"></div>
    </div>

    <!-- ========== 数据库 API ========== -->
    <div class="api-section">
      <h2><span class="icon">💾</span>文档数据库 (db)</h2>
      <div class="info-box">
        💡 提示：每次 put 使用不同的 _id 会添加新文档，相同 _id 会更新现有文档
      </div>
      <div class="input-group">
        <input type="text" id="dbDocId" placeholder="文档 ID" value="test_doc_1" />
        <textarea id="dbDocContent" placeholder="文档内容 (JSON)">{"name": "测试文档", "value": 123}</textarea>
      </div>
      <div class="button-group">
        <button onclick="testDbPut()">put (保存)</button>
        <button onclick="testDbPutRandom()" style="background: #28a745;">put (随机ID)</button>
        <button onclick="testDbGet()">get (读取)</button>
        <button onclick="testDbRemove()">remove (删除)</button>
        <button onclick="testDbAllDocs()">allDocs (全部)</button>
        <button class="danger" onclick="testDbClearAll()">清空所有</button>
      </div>
      <div class="divider"></div>
      <div class="info-box" style="background: #fff3cd; border-color: #ffc107; color: #856404;">
        📚 实用案例：用户设置保存
      </div>
      <div class="button-group">
        <button onclick="testDbUseCaseUserSettings()" style="background: #28a745;">保存用户设置</button>
        <button onclick="testDbUseCaseLoadSettings()">读取用户设置</button>
        <button onclick="testDbUseCaseSearchHistory()" style="background: #17a2b8;">保存搜索历史</button>
        <button onclick="testDbUseCaseBulkSave()" style="background: #6f42c1;">批量保存数据</button>
      </div>
      <div id="dbOutput" class="output"></div>
    </div>

    <!-- ========== 键值存储 API ========== -->
    <div class="api-section">
      <h2><span class="icon">🗄️</span>键值存储 (storage)</h2>
      <div class="input-group">
        <input type="text" id="storageKey" placeholder="键名" value="test_key" />
        <input type="text" id="storageValue" placeholder="值" value="测试数据" />
      </div>
      <div class="button-group">
        <button onclick="testStorageSet()">setItem (保存)</button>
        <button onclick="testStorageGet()">getItem (读取)</button>
        <button onclick="testStorageGetAll()">getAllItems (全部)</button>
        <button onclick="testStorageRemove()">removeItem (删除)</button>
        <button class="danger" onclick="testStorageClear()">clear (清空)</button>
      </div>
      <div id="storageOutput" class="output"></div>
    </div>

    <!-- ========== 剪贴板 API ========== -->
    <div class="api-section">
      <h2><span class="icon">📋</span>剪贴板 (clipboard)</h2>
      <div class="input-group">
        <input type="text" id="clipboardText" placeholder="要复制的文本" value="Hello Naimo!" />
        <button onclick="testClipboardWriteText()">写入文本</button>
        <button onclick="testClipboardReadText()">读取文本</button>
      </div>
      <div class="button-group">
        <button onclick="testClipboardHasText()">hasText (检查文本)</button>
        <button onclick="testClipboardHasImage()">hasImage (检查图片)</button>
        <button onclick="testClipboardReadImage()">readImage (读取图片)</button>
        <button class="danger" onclick="testClipboardClear()">clear (清空)</button>
      </div>
      <div class="divider"></div>
      <div class="info-box" style="background: #fff3cd; border-color: #ffc107; color: #856404;">
        📚 实用案例：剪贴板操作
      </div>
      <div class="button-group">
        <button onclick="testClipboardUseCaseCopyJson()" style="background: #28a745;">复制JSON数据</button>
        <button onclick="testClipboardUseCaseCopyLink()">复制链接</button>
        <button onclick="testClipboardUseCaseFormatText()" style="background: #17a2b8;">格式化并复制</button>
        <button onclick="testClipboardUseCaseMonitor()" style="background: #6f42c1;">监听剪贴板</button>
      </div>
      <div id="clipboardOutput" class="output"></div>
    </div>

    <!-- ========== Shell 操作 API ========== -->
    <div class="api-section">
      <h2><span class="icon">🐚</span>Shell 操作 (shell)</h2>
      <div class="input-group">
        <input type="text" id="shellPath" placeholder="文件路径" value="C:\\" />
      </div>
      <div class="button-group">
        <button onclick="testShellOpenPath()">openPath (打开路径)</button>
        <button onclick="testShellShowInFolder()">showInFolder (在文件夹中显示)</button>
        <button onclick="testShellOpenUrl()">openUrl (打开网址)</button>
        <button onclick="testShellBeep()">beep (播放提示音)</button>
      </div>
      <div class="divider"></div>
      <div class="info-box" style="background: #fff3cd; border-color: #ffc107; color: #856404;">
        📚 实用案例：快速访问常用路径
      </div>
      <div class="button-group">
        <button onclick="testShellUseCaseOpenDesktop()" style="background: #28a745;">打开桌面</button>
        <button onclick="testShellUseCaseOpenDownloads()">打开下载</button>
        <button onclick="testShellUseCaseOpenDocs()" style="background: #17a2b8;">打开文档</button>
        <button onclick="testShellUseCaseQuickSearch()" style="background: #6f42c1;">快速搜索GitHub</button>
      </div>
      <div id="shellOutput" class="output"></div>
    </div>

    <!-- ========== 系统信息 API ========== -->
    <div class="api-section">
      <h2><span class="icon">💻</span>系统信息 (system)</h2>
      <div class="input-group">
        <input type="text" id="notifyMessage" placeholder="通知消息" value="测试通知" />
        <input type="text" id="notifyTitle" placeholder="通知标题" value="Naimo" />
        <button onclick="testSystemNotify()">发送通知</button>
      </div>
      <div class="button-group">
        <button onclick="testSystemGetVersion()">getVersion (版本)</button>
        <button onclick="testSystemGetName()">getName (应用名)</button>
        <button onclick="testSystemGetDeviceId()">getDeviceId (设备ID)</button>
        <button onclick="testSystemIsMac()">isMac</button>
        <button onclick="testSystemIsWindows()">isWindows</button>
        <button onclick="testSystemIsLinux()">isLinux</button>
        <button onclick="testSystemGetPath()">getPath (系统路径)</button>
      </div>
      <div id="systemOutput" class="output"></div>
    </div>

    <!-- ========== 屏幕与显示器 API ========== -->
    <div class="api-section">
      <h2><span class="icon">🖥️</span>屏幕与显示器 (screen)</h2>
      <div class="button-group">
        <button onclick="testScreenGetSources()">getSources (获取源)</button>
        <button onclick="testScreenGetCursorPosition()">getCursorPosition (光标位置)</button>
        <button onclick="testScreenGetPrimaryDisplay()">getPrimaryDisplay (主显示器)</button>
        <button onclick="testScreenGetAllDisplays()">getAllDisplays (所有显示器)</button>
        <button onclick="testScreenCapture()">capture (截图)</button>
      </div>
      <div id="screenOutput" class="output"></div>
    </div>

    <!-- ========== 对话框 API ========== -->
    <div class="api-section">
      <h2><span class="icon">💬</span>对话框 (dialog)</h2>
      <div class="button-group">
        <button onclick="testDialogShowOpen()">showOpen (打开文件)</button>
        <button onclick="testDialogShowSave()">showSave (保存文件)</button>
        <button onclick="testDialogShowMessage()">showMessage (消息框)</button>
        <button onclick="testDialogShowError()">showError (错误框)</button>
      </div>
      <div class="divider"></div>
      <div class="info-box" style="background: #fff3cd; border-color: #ffc107; color: #856404;">
        📚 实用案例：文件选择与保存
      </div>
      <div class="button-group">
        <button onclick="testDialogUseCaseSelectImage()" style="background: #28a745;">选择图片</button>
        <button onclick="testDialogUseCaseSelectMultiFiles()">选择多个文件</button>
        <button onclick="testDialogUseCaseExportJson()" style="background: #17a2b8;">导出JSON配置</button>
        <button onclick="testDialogUseCaseConfirm()" style="background: #6f42c1;">确认对话框</button>
      </div>
      <div id="dialogOutput" class="output"></div>
    </div>

    <!-- ========== 输入模拟 API ========== -->
    <div class="api-section">
      <h2><span class="icon">⌨️</span>输入模拟 (input)</h2>
      <div class="info-box">
        ⚠️ 注意：输入模拟功能需要窗口失去焦点后才能生效
      </div>
      <div class="input-group">
        <input type="text" id="inputText" placeholder="要粘贴的文本" value="Hello from Naimo!" />
        <button onclick="testInputPasteText()">pasteText (粘贴文本)</button>
      </div>
      <div class="input-group">
        <input type="text" id="inputKey" placeholder="按键 (如: a, Enter)" value="a" />
        <button onclick="testInputSimulateKeyPress()">simulateKeyPress (模拟按键)</button>
      </div>
      <div id="inputOutput" class="output"></div>
    </div>

    <!-- ========== 网页自动化 API ========== -->
    <div class="api-section">
      <h2><span class="icon">🤖</span>网页自动化 (automation)</h2>
      <div class="info-box">
        💡 提示：使用 Puppeteer 进行网页自动化操作，支持点击、输入、等待等操作
      </div>
      <div class="input-group">
        <input type="text" id="automationUrl" placeholder="目标网址" value="https://www.baidu.com" />
      </div>
      <div class="button-group">
        <button onclick="testAutomationFetchHTML()">fetchHTML (获取HTML)</button>
        <button onclick="testAutomationFetchJSON()">fetchJSON (获取JSON)</button>
        <button onclick="testAutomationWithSteps()">automateWithJson (自动化任务)</button>
        <button onclick="testAutomationSearch()" style="background: #28a745;">百度搜索示例</button>
      </div>
      <div class="divider"></div>
      <div class="info-box" style="background: #fff3cd; border-color: #ffc107; color: #856404;">
        📚 实用案例：网页数据采集和自动化
      </div>
      <div class="button-group">
        <button onclick="testAutomationUseCaseGetTitle()" style="background: #28a745;">获取网页标题</button>
        <button onclick="testAutomationUseCaseAPIData()">API 数据获取</button>
        <button onclick="testAutomationUseCaseLogin()" style="background: #17a2b8;">百度搜索自动化</button>
        <button onclick="testAutomationUseCaseDataCrawl()" style="background: #6f42c1;">B站番剧爬取</button>
      </div>
      <div id="automationOutput" class="output"></div>
    </div>

    <!-- ========== 可编程浏览器 API (UBrowser) ========== -->
    <div class="api-section">
      <h2><span class="icon">🌐</span>可编程浏览器 (ubrowser)</h2>
      <div class="info-box">
        💡 提示：UBrowser 提供两种模式 - <strong>链式调用模式</strong>（构建队列统一执行）和<strong>即时执行模式</strong>（每步立即执行）
      </div>

      <h3 style="margin-top: 20px;">📦 链式调用模式（自动化脚本）</h3>
      <div class="info-box" style="background: #e7f3ff; border-color: #2196f3;">
        <strong>🎯 特性：</strong>构建操作队列，最后统一执行<br>
        <strong>💡 语法：</strong><code>naimo.ubrowser.goto().wait().click().run()</code>
      </div>
      <div class="button-group">
        <button onclick="testUBrowserBasic()" style="background: #28a745;">基础示例</button>
        <button onclick="testUBrowserSearch()" style="background: #17a2b8;">百度搜索</button>
        <button onclick="testUBrowserExpressQuery()" style="background: #6f42c1;">快递查询</button>
        <button onclick="testUBrowserScreenshot()" style="background: #fd7e14;">网页截图</button>
        <button onclick="testUBrowserCondition()" style="background: #e83e8c;">条件判断</button>
      </div>
      <div id="ubrowserOutput" class="output"></div>

      <div class="divider"></div>

      <h3>⚡ 即时执行模式（逐步操作）</h3>
      <div class="info-box" style="background: #fff3cd; border-color: #ffc107; color: #856404;">
        <strong>🎯 特性：</strong>每个操作立即执行，窗口保持打开<br>
        <strong>💡 语法：</strong><code>const b = naimo.instantBrowser.create(); await b.goto()</code>
      </div>
      <div class="button-group">
        <button onclick="testInstantStep1()" style="background: #007bff;">① 打开网页</button>
        <button onclick="testInstantStep2()" style="background: #007bff;">② 等待元素</button>
        <button onclick="testInstantStep3()" style="background: #007bff;">③ 输入文本</button>
        <button onclick="testInstantStep4()" style="background: #007bff;">④ 点击搜索</button>
        <button onclick="testInstantStep5()" style="background: #007bff;">⑤ 提取结果</button>
        <button onclick="testInstantClose()" class="danger">关闭浏览器</button>
      </div>
      <div id="instantOutput" class="output"></div>
    </div>

    <!-- ========== 本地测试页面自动化 ========== -->
    <div class="api-section">
      <h2><span class="icon">🧪</span>本地测试页面自动化 (test.html)</h2>
      <div class="info-box">
        💡 测试本地 HTTP 服务器上的 test.html 页面<br>
        📝 请先运行: <code>python server.py</code><br>
        🌐 测试地址: <code>http://localhost:8000/test.html</code>
      </div>

      <h3 style="margin-top: 20px;">🎯 三种自动化模式对比</h3>

      <!-- 模式1: automateWithJson -->
      <div class="info-box" style="background: #e7f3ff; border-color: #2196f3;">
        <strong>模式1: automateWithJson (配置模式)</strong><br>
        • 完全基于JSON配置<br>
        • 适合一次性任务<br>
        • 任务结束后自动关闭窗口
      </div>
      <div class="button-group">
        <button onclick="testLocalAutomateLogin()" style="background: #28a745;">测试登录表单</button>
        <button onclick="testLocalAutomateSearch()" style="background: #17a2b8;">测试搜索功能</button>
        <button onclick="testLocalAutomateForm()" style="background: #6f42c1;">测试数据表单</button>
      </div>
      <div id="localAutomateOutput" class="output"></div>

      <div class="divider"></div>

      <!-- 模式2: UBrowser 链式调用 -->
      <div class="info-box" style="background: #fff3cd; border-color: #ffc107; color: #856404;">
        <strong>模式2: UBrowser (链式调用模式)</strong><br>
        • 优雅的链式API<br>
        • 构建队列统一执行<br>
        • 返回所有步骤结果
      </div>
      <div class="button-group">
        <button onclick="testLocalUBrowserLogin()" style="background: #28a745;">链式-登录表单</button>
        <button onclick="testLocalUBrowserSearch()" style="background: #17a2b8;">链式-搜索功能</button>
        <button onclick="testLocalUBrowserComplex()" style="background: #6f42c1;">链式-复杂表单</button>
        <button onclick="testLocalUBrowserAll()" style="background: #e83e8c;">链式-完整流程</button>
      </div>
      <div id="localUBrowserOutput" class="output"></div>

      <div class="divider"></div>

      <!-- 模式3: InstantBrowser 即时执行 -->
      <div class="info-box" style="background: #f8d7da; border-color: #dc3545; color: #721c24;">
        <strong>模式3: InstantBrowser (即时执行模式)</strong><br>
        • 每步立即执行<br>
        • 窗口保持打开<br>
        • 可交互调试
      </div>
      <div class="button-group">
        <button onclick="testLocalInstantStart()" style="background: #007bff;">① 打开页面</button>
        <button onclick="testLocalInstantLogin()" style="background: #007bff;">② 填写登录</button>
        <button onclick="testLocalInstantSearch()" style="background: #007bff;">③ 执行搜索</button>
        <button onclick="testLocalInstantForm()" style="background: #007bff;">④ 填写表单</button>
        <button onclick="testLocalInstantClose()" class="danger">⑤ 关闭浏览器</button>
      </div>
      <div id="localInstantOutput" class="output"></div>

      <div class="divider"></div>

      <!-- 综合对比 -->
      <div class="info-box" style="background: linear-gradient(135deg, #667eea22 0%, #764ba222 100%);">
        <strong>📊 三种模式对比总结</strong><br><br>
        <strong>1. automateWithJson (配置模式)</strong><br>
        ✅ 优点: 配置清晰、易于存储和传输<br>
        ❌ 缺点: 不够灵活、需要预先定义所有步骤<br>
        🎯 适用: 固定流程的自动化任务<br><br>

        <strong>2. UBrowser (链式调用)</strong><br>
        ✅ 优点: API优雅、代码可读性高、统一执行<br>
        ❌ 缺点: 无法中途调整、调试不便<br>
        🎯 适用: 脚本化自动化、批量处理<br><br>

        <strong>3. InstantBrowser (即时执行)</strong><br>
        ✅ 优点: 灵活可控、便于调试、可交互<br>
        ❌ 缺点: 需要手动管理生命周期<br>
        🎯 适用: 需要人工干预的半自动化任务
      </div>
    </div>
  </div>

  <script>
    // ==================== 工具函数 ====================
    function displayResult(elementId, result, isError = false) {
      const output = document.getElementById(elementId);
      output.className = `output ${isError ? "error" : "success"}`;
      output.textContent =
        typeof result === "object"
          ? JSON.stringify(result, null, 2)
          : String(result);
    }

    function displayError(elementId, error) {
      displayResult(elementId, `错误: ${error.message || error}`, true);
    }

    // ==================== 日志 API 测试 ====================
    function testLogError() {
      window.naimo.log.error("这是一条错误日志", { detail: "错误详情" });
      displayResult("logOutput", "已记录错误日志，请查看控制台");
    }

    function testLogWarn() {
      window.naimo.log.warn("这是一条警告日志");
      displayResult("logOutput", "已记录警告日志，请查看控制台");
    }

    function testLogInfo() {
      window.naimo.log.info("这是一条信息日志");
      displayResult("logOutput", "已记录信息日志，请查看控制台");
    }

    function testLogDebug() {
      window.naimo.log.debug("这是一条调试日志");
      displayResult("logOutput", "已记录调试日志，请查看控制台");
    }

    function testLogThrowError() {
      try {
        window.naimo.log.throw_error(new Error("测试错误"), {
          title: "测试错误对话框",
        });
        displayResult("logOutput", "已触发错误对话框");
      } catch (error) {
        displayError("logOutput", error);
      }
    }

    // ==================== 窗口管理 API 测试 ====================
    function testWindowHide() {
      window.naimo.window.hide();
      displayResult("windowOutput", "窗口已隐藏（3秒后自动显示）");
      setTimeout(() => window.naimo.window.show(), 3000);
    }

    function testWindowShow() {
      window.naimo.window.show();
      displayResult("windowOutput", "窗口已显示");
    }

    function testWindowMinimize() {
      window.naimo.window.minimize();
      displayResult("windowOutput", "窗口已最小化");
    }

    function testWindowMaximize() {
      window.naimo.window.maximize();
      displayResult("windowOutput", "窗口已最大化/还原");
    }

    function testWindowClose() {
      if (confirm("确定要关闭窗口吗？")) {
        window.naimo.window.close();
      }
    }

    function testWindowSetHeight() {
      const height = parseInt(document.getElementById("windowHeight").value);
      window.naimo.window.setHeight(height);
      displayResult("windowOutput", `窗口高度已设置为 ${height}px`);
    }

    function testWindowSetSize() {
      const width = parseInt(document.getElementById("windowWidth").value);
      const height = parseInt(
        document.getElementById("windowHeightForSize").value
      );
      window.naimo.window.setSize(width, height);
      displayResult(
        "windowOutput",
        `窗口尺寸已设置为 ${width}x${height}px`
      );
    }

    // ==================== 数据库 API 测试 ====================
    async function testDbPut() {
      try {
        const id = document.getElementById("dbDocId").value;
        const content = JSON.parse(
          document.getElementById("dbDocContent").value
        );
        const doc = { _id: id, ...content };
        const result = await window.naimo.db.put(doc);
        displayResult("dbOutput", result);
      } catch (error) {
        displayError("dbOutput", error);
      }
    }

    async function testDbPutRandom() {
      try {
        const content = JSON.parse(
          document.getElementById("dbDocContent").value
        );
        // 生成随机 ID
        const randomId = `test_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
        const doc = { _id: randomId, ...content };
        const result = await window.naimo.db.put(doc);
        displayResult("dbOutput", `已添加新文档: ${randomId}\n${JSON.stringify(result, null, 2)}`);
      } catch (error) {
        displayError("dbOutput", error);
      }
    }

    async function testDbClearAll() {
      try {
        if (confirm("确定要清空所有测试数据吗？")) {
          const docs = await window.naimo.db.allDocs("test_");
          for (const doc of docs) {
            await window.naimo.db.remove(doc._id);
          }
          displayResult("dbOutput", `已清空 ${docs.length} 条数据`);
        }
      } catch (error) {
        displayError("dbOutput", error);
      }
    }

    async function testDbGet() {
      try {
        const id = document.getElementById("dbDocId").value;
        const result = await window.naimo.db.get(id);
        displayResult("dbOutput", result);
      } catch (error) {
        displayError("dbOutput", error);
      }
    }

    async function testDbRemove() {
      try {
        const id = document.getElementById("dbDocId").value;
        const result = await window.naimo.db.remove(id);
        displayResult("dbOutput", result);
      } catch (error) {
        displayError("dbOutput", error);
      }
    }

    async function testDbAllDocs() {
      try {
        const result = await window.naimo.db.allDocs("test_");
        displayResult("dbOutput", result);
      } catch (error) {
        displayError("dbOutput", error);
      }
    }

    // ==================== 数据库实用案例 ====================

    // 案例1: 保存用户设置（主题、语言、字体大小等）
    async function testDbUseCaseUserSettings() {
      try {
        const userSettings = {
          _id: "user_settings",
          theme: "dark",
          language: "zh-CN",
          fontSize: 14,
          autoSave: true,
          lastModified: new Date().toISOString()
        };
        const result = await window.naimo.db.put(userSettings);
        displayResult(
          "dbOutput",
          `✅ 用户设置已保存:\n${JSON.stringify(userSettings, null, 2)}\n\n保存结果:\n${JSON.stringify(result, null, 2)}`
        );
      } catch (error) {
        displayError("dbOutput", error);
      }
    }

    // 案例2: 读取用户设置
    async function testDbUseCaseLoadSettings() {
      try {
        const settings = await window.naimo.db.get("user_settings");
        if (settings) {
          displayResult(
            "dbOutput",
            `✅ 用户设置读取成功:\n${JSON.stringify(settings, null, 2)}`
          );
        } else {
          displayResult("dbOutput", "⚠️ 未找到用户设置，请先保存设置");
        }
      } catch (error) {
        displayError("dbOutput", error);
      }
    }

    // 案例3: 保存搜索历史（带时间戳）
    async function testDbUseCaseSearchHistory() {
      try {
        const timestamp = Date.now();
        const searchRecord = {
          _id: `search_history_${timestamp}`,
          keyword: "Electron API",
          timestamp: timestamp,
          type: "web_search",
          results: 42
        };

        await window.naimo.db.put(searchRecord);

        // 读取所有搜索历史
        const allHistory = await window.naimo.db.allDocs("search_history_");
        displayResult(
          "dbOutput",
          `✅ 搜索历史已保存\n\n当前共有 ${allHistory.length} 条搜索记录:\n${JSON.stringify(allHistory.slice(-5), null, 2)}`
        );
      } catch (error) {
        displayError("dbOutput", error);
      }
    }

    // 案例4: 批量保存数据
    async function testDbUseCaseBulkSave() {
      try {
        const bookmarks = [
          { _id: "bookmark_1", title: "GitHub", url: "https://github.com", category: "dev" },
          { _id: "bookmark_2", title: "Stack Overflow", url: "https://stackoverflow.com", category: "dev" },
          { _id: "bookmark_3", title: "MDN", url: "https://developer.mozilla.org", category: "docs" }
        ];

        const results = await window.naimo.db.bulkDocs(bookmarks);

        displayResult(
          "dbOutput",
          `✅ 批量保存了 ${bookmarks.length} 个书签:\n${JSON.stringify(results, null, 2)}`
        );
      } catch (error) {
        displayError("dbOutput", error);
      }
    }

    // ==================== 键值存储 API 测试 ====================
    async function testStorageSet() {
      try {
        const key = document.getElementById("storageKey").value;
        const value = document.getElementById("storageValue").value;
        await window.naimo.storage.setItem(key, value);
        displayResult("storageOutput", `已保存: ${key} = ${value}`);
      } catch (error) {
        displayError("storageOutput", error);
      }
    }

    async function testStorageGet() {
      try {
        const key = document.getElementById("storageKey").value;
        const result = await window.naimo.storage.getItem(key);
        displayResult("storageOutput", result || "未找到该键");
      } catch (error) {
        displayError("storageOutput", error);
      }
    }

    async function testStorageGetAll() {
      try {
        const result = await window.naimo.storage.getAllItems();
        displayResult("storageOutput", result);
      } catch (error) {
        displayError("storageOutput", error);
      }
    }

    async function testStorageRemove() {
      try {
        const key = document.getElementById("storageKey").value;
        await window.naimo.storage.removeItem(key);
        displayResult("storageOutput", `已删除: ${key}`);
      } catch (error) {
        displayError("storageOutput", error);
      }
    }

    async function testStorageClear() {
      try {
        if (confirm("确定要清空所有存储吗？")) {
          await window.naimo.storage.clear();
          displayResult("storageOutput", "已清空所有存储");
        }
      } catch (error) {
        displayError("storageOutput", error);
      }
    }

    // ==================== 剪贴板 API 测试 ====================
    async function testClipboardWriteText() {
      try {
        const text = document.getElementById("clipboardText").value;
        await window.naimo.clipboard.writeText(text);
        displayResult("clipboardOutput", `已写入剪贴板: ${text}`);
      } catch (error) {
        displayError("clipboardOutput", error);
      }
    }

    async function testClipboardReadText() {
      try {
        const result = await window.naimo.clipboard.readText();
        displayResult("clipboardOutput", result || "剪贴板为空");
      } catch (error) {
        displayError("clipboardOutput", error);
      }
    }

    async function testClipboardHasText() {
      try {
        const result = await window.naimo.clipboard.hasText();
        displayResult(
          "clipboardOutput",
          `剪贴板${result ? "有" : "没有"}文本`
        );
      } catch (error) {
        displayError("clipboardOutput", error);
      }
    }

    async function testClipboardHasImage() {
      try {
        const result = await window.naimo.clipboard.hasImage();
        displayResult(
          "clipboardOutput",
          `剪贴板${result ? "有" : "没有"}图片`
        );
      } catch (error) {
        displayError("clipboardOutput", error);
      }
    }

    async function testClipboardReadImage() {
      try {
        const result = await window.naimo.clipboard.readImage();
        if (result) {
          displayResult(
            "clipboardOutput",
            `已读取图片 (${result.substring(0, 50)}...)`
          );
        } else {
          displayResult("clipboardOutput", "剪贴板中没有图片");
        }
      } catch (error) {
        displayError("clipboardOutput", error);
      }
    }

    async function testClipboardClear() {
      try {
        await window.naimo.clipboard.clear();
        displayResult("clipboardOutput", "已清空剪贴板");
      } catch (error) {
        displayError("clipboardOutput", error);
      }
    }

    // ==================== 剪贴板实用案例 ====================

    // 案例1: 复制JSON数据（格式化）
    async function testClipboardUseCaseCopyJson() {
      try {
        const data = {
          name: "Naimo Tools",
          version: "1.0.0",
          features: ["快速启动", "插件系统", "数据存储"],
          config: {
            theme: "dark",
            language: "zh-CN"
          }
        };
        const jsonString = JSON.stringify(data, null, 2);
        await window.naimo.clipboard.writeText(jsonString);
        displayResult(
          "clipboardOutput",
          `✅ JSON数据已复制到剪贴板:\n${jsonString}`
        );
      } catch (error) {
        displayError("clipboardOutput", error);
      }
    }

    // 案例2: 复制Markdown链接
    async function testClipboardUseCaseCopyLink() {
      try {
        const title = "Naimo Tools - GitHub";
        const url = "https://github.com/imohuan/naimo_tools";
        const markdownLink = `[${title}](${url})`;
        await window.naimo.clipboard.writeText(markdownLink);
        displayResult(
          "clipboardOutput",
          `✅ Markdown链接已复制:\n${markdownLink}`
        );
      } catch (error) {
        displayError("clipboardOutput", error);
      }
    }

    // 案例3: 格式化文本并复制
    async function testClipboardUseCaseFormatText() {
      try {
        const rawText = await window.naimo.clipboard.readText();
        if (!rawText) {
          displayResult("clipboardOutput", "⚠️ 剪贴板为空");
          return;
        }
        // 移除多余空白并格式化
        const formatted = rawText.trim().replace(/\s+/g, " ");
        await window.naimo.clipboard.writeText(formatted);
        displayResult(
          "clipboardOutput",
          `✅ 文本已格式化并复制:\n原文: ${rawText.substring(0, 50)}...\n格式化后: ${formatted.substring(0, 50)}...`
        );
      } catch (error) {
        displayError("clipboardOutput", error);
      }
    }

    // 案例4: 监听剪贴板变化（演示）
    let clipboardMonitorInterval;
    async function testClipboardUseCaseMonitor() {
      try {
        if (clipboardMonitorInterval) {
          clearInterval(clipboardMonitorInterval);
          clipboardMonitorInterval = null;
          displayResult("clipboardOutput", "❌ 已停止监听剪贴板");
          return;
        }

        let lastText = await window.naimo.clipboard.readText();
        displayResult("clipboardOutput", "✅ 开始监听剪贴板变化（再次点击停止）\n当前内容: " + (lastText || "空"));

        clipboardMonitorInterval = setInterval(async () => {
          const currentText = await window.naimo.clipboard.readText();
          if (currentText !== lastText) {
            lastText = currentText;
            displayResult(
              "clipboardOutput",
              `🔔 检测到剪贴板变化:\n${currentText?.substring(0, 100) || "空"}...`
            );
          }
        }, 1000);
      } catch (error) {
        displayError("clipboardOutput", error);
      }
    }

    // ==================== Shell 操作 API 测试 ====================
    async function testShellOpenPath() {
      try {
        const path = document.getElementById("shellPath").value;
        await window.naimo.shell.openPath(path);
        displayResult("shellOutput", `已打开路径: ${path}`);
      } catch (error) {
        displayError("shellOutput", error);
      }
    }

    async function testShellShowInFolder() {
      try {
        const path = document.getElementById("shellPath").value;
        await window.naimo.shell.showInFolder(path);
        displayResult("shellOutput", `已在文件夹中显示: ${path}`);
      } catch (error) {
        displayError("shellOutput", error);
      }
    }

    async function testShellOpenUrl() {
      try {
        await window.naimo.shell.openUrl("https://github.com");
        displayResult("shellOutput", "已在浏览器中打开 GitHub");
      } catch (error) {
        displayError("shellOutput", error);
      }
    }

    async function testShellBeep() {
      try {
        await window.naimo.shell.beep();
        displayResult("shellOutput", "已播放系统提示音");
      } catch (error) {
        displayError("shellOutput", error);
      }
    }

    // ==================== Shell 实用案例 ====================

    // 案例1: 快速打开桌面文件夹
    async function testShellUseCaseOpenDesktop() {
      try {
        const desktopPath = await window.naimo.system.getPath("desktop");
        await window.naimo.shell.openPath(desktopPath);
        displayResult("shellOutput", `✅ 已打开桌面文件夹:\n${desktopPath}`);
      } catch (error) {
        displayError("shellOutput", error);
      }
    }

    // 案例2: 快速打开下载文件夹
    async function testShellUseCaseOpenDownloads() {
      try {
        const downloadsPath = await window.naimo.system.getPath("downloads");
        await window.naimo.shell.openPath(downloadsPath);
        displayResult("shellOutput", `✅ 已打开下载文件夹:\n${downloadsPath}`);
      } catch (error) {
        displayError("shellOutput", error);
      }
    }

    // 案例3: 快速打开文档文件夹
    async function testShellUseCaseOpenDocs() {
      try {
        const docsPath = await window.naimo.system.getPath("documents");
        await window.naimo.shell.openPath(docsPath);
        displayResult("shellOutput", `✅ 已打开文档文件夹:\n${docsPath}`);
      } catch (error) {
        displayError("shellOutput", error);
      }
    }

    // 案例4: 快速搜索（打开GitHub）
    async function testShellUseCaseQuickSearch() {
      try {
        const keyword = "electron";
        const searchUrl = `https://github.com/search?q=${encodeURIComponent(keyword)}`;
        await window.naimo.shell.openUrl(searchUrl);
        displayResult("shellOutput", `✅ 已在浏览器中搜索:\n关键词: ${keyword}\nURL: ${searchUrl}`);
      } catch (error) {
        displayError("shellOutput", error);
      }
    }

    // ==================== 系统信息 API 测试 ====================
    async function testSystemNotify() {
      try {
        const message = document.getElementById("notifyMessage").value;
        const title = document.getElementById("notifyTitle").value;
        await window.naimo.system.notify(message, title);
        displayResult("systemOutput", "已发送系统通知");
      } catch (error) {
        displayError("systemOutput", error);
      }
    }

    async function testSystemGetVersion() {
      try {
        const result = await window.naimo.system.getVersion();
        displayResult("systemOutput", `应用版本: ${result}`);
      } catch (error) {
        displayError("systemOutput", error);
      }
    }

    async function testSystemGetName() {
      try {
        const result = await window.naimo.system.getName();
        displayResult("systemOutput", `应用名称: ${result}`);
      } catch (error) {
        displayError("systemOutput", error);
      }
    }

    async function testSystemGetDeviceId() {
      try {
        const result = await window.naimo.system.getDeviceId();
        displayResult("systemOutput", `设备ID: ${result}`);
      } catch (error) {
        displayError("systemOutput", error);
      }
    }

    async function testSystemIsMac() {
      try {
        const result = await window.naimo.system.isMac();
        displayResult("systemOutput", `是否为 Mac: ${result}`);
      } catch (error) {
        displayError("systemOutput", error);
      }
    }

    async function testSystemIsWindows() {
      try {
        const result = await window.naimo.system.isWindows();
        displayResult("systemOutput", `是否为 Windows: ${result}`);
      } catch (error) {
        displayError("systemOutput", error);
      }
    }

    async function testSystemIsLinux() {
      try {
        const result = await window.naimo.system.isLinux();
        displayResult("systemOutput", `是否为 Linux: ${result}`);
      } catch (error) {
        displayError("systemOutput", error);
      }
    }

    async function testSystemGetPath() {
      try {
        const paths = {
          home: await window.naimo.system.getPath("home"),
          temp: await window.naimo.system.getPath("temp"),
          desktop: await window.naimo.system.getPath("desktop"),
        };
        displayResult("systemOutput", paths);
      } catch (error) {
        displayError("systemOutput", error);
      }
    }

    // ==================== 屏幕与显示器 API 测试 ====================
    async function testScreenGetSources() {
      try {
        const result = await window.naimo.screen.getSources({
          types: ["screen", "window"],
          thumbnailSize: { width: 150, height: 150 },
        });
        displayResult("screenOutput", `找到 ${result.length} 个源`);
      } catch (error) {
        displayError("screenOutput", error);
      }
    }

    async function testScreenGetCursorPosition() {
      try {
        const result = await window.naimo.screen.getCursorPosition();
        displayResult("screenOutput", result);
      } catch (error) {
        displayError("screenOutput", error);
      }
    }

    async function testScreenGetPrimaryDisplay() {
      try {
        const result = await window.naimo.screen.getPrimaryDisplay();
        displayResult("screenOutput", result);
      } catch (error) {
        displayError("screenOutput", error);
      }
    }

    async function testScreenGetAllDisplays() {
      try {
        const result = await window.naimo.screen.getAllDisplays();
        displayResult("screenOutput", result);
      } catch (error) {
        displayError("screenOutput", error);
      }
    }

    async function testScreenCapture() {
      try {
        const result = await window.naimo.screen.capture();
        displayResult("screenOutput", `截图已保存: ${result}`);
      } catch (error) {
        displayError("screenOutput", error);
      }
    }

    // ==================== 对话框 API 测试 ====================
    async function testDialogShowOpen() {
      try {
        const result = await window.naimo.dialog.showOpen({
          title: "选择文件",
          properties: ["openFile", "multiSelections"],
        });
        displayResult("dialogOutput", result);
      } catch (error) {
        displayError("dialogOutput", error);
      }
    }

    async function testDialogShowSave() {
      try {
        const result = await window.naimo.dialog.showSave({
          title: "保存文件",
          defaultPath: "test.txt",
        });
        displayResult("dialogOutput", result);
      } catch (error) {
        displayError("dialogOutput", error);
      }
    }

    async function testDialogShowMessage() {
      try {
        const result = await window.naimo.dialog.showMessage({
          type: "info",
          title: "测试消息",
          message: "这是一个测试消息框",
          buttons: ["确定", "取消"],
        });
        displayResult("dialogOutput", result);
      } catch (error) {
        displayError("dialogOutput", error);
      }
    }

    async function testDialogShowError() {
      try {
        await window.naimo.dialog.showError("错误标题", "这是一个错误消息");
        displayResult("dialogOutput", "已显示错误对话框");
      } catch (error) {
        displayError("dialogOutput", error);
      }
    }

    // ==================== 对话框实用案例 ====================

    // 案例1: 选择图片文件
    async function testDialogUseCaseSelectImage() {
      try {
        const result = await window.naimo.dialog.showOpen({
          title: "选择图片",
          filters: [
            { name: "图片文件", extensions: ["png", "jpg", "jpeg", "gif", "webp"] },
            { name: "所有文件", extensions: ["*"] }
          ],
          properties: ["openFile"]
        });

        if (result && result.length > 0) {
          displayResult(
            "dialogOutput",
            `✅ 已选择图片:\n${result[0]}`
          );
        } else {
          displayResult("dialogOutput", "⚠️ 未选择文件");
        }
      } catch (error) {
        displayError("dialogOutput", error);
      }
    }

    // 案例2: 选择多个文件
    async function testDialogUseCaseSelectMultiFiles() {
      try {
        const result = await window.naimo.dialog.showOpen({
          title: "选择多个文件",
          properties: ["openFile", "multiSelections"]
        });

        if (result && result.length > 0) {
          displayResult(
            "dialogOutput",
            `✅ 已选择 ${result.length} 个文件:\n${result.map((f, i) => `${i + 1}. ${f}`).join("\n")}`
          );
        } else {
          displayResult("dialogOutput", "⚠️ 未选择文件");
        }
      } catch (error) {
        displayError("dialogOutput", error);
      }
    }

    // 案例3: 导出JSON配置文件
    async function testDialogUseCaseExportJson() {
      try {
        const result = await window.naimo.dialog.showSave({
          title: "导出配置文件",
          defaultPath: "naimo_config.json",
          filters: [
            { name: "JSON文件", extensions: ["json"] },
            { name: "所有文件", extensions: ["*"] }
          ]
        });

        if (result) {
          // 这里可以保存文件
          const config = {
            version: "1.0.0",
            settings: {
              theme: "dark",
              language: "zh-CN"
            },
            exportTime: new Date().toISOString()
          };

          displayResult(
            "dialogOutput",
            `✅ 选择保存路径:\n${result}\n\n配置内容:\n${JSON.stringify(config, null, 2)}\n\n💡 提示：实际使用时可配合文件系统API保存`
          );
        } else {
          displayResult("dialogOutput", "⚠️ 取消保存");
        }
      } catch (error) {
        displayError("dialogOutput", error);
      }
    }

    // 案例4: 确认对话框
    async function testDialogUseCaseConfirm() {
      try {
        const result = await window.naimo.dialog.showMessage({
          type: "question",
          title: "确认操作",
          message: "是否要删除所有测试数据？",
          detail: "此操作不可撤销，请谨慎选择",
          buttons: ["取消", "确定"],
          defaultId: 0,
          cancelId: 0
        });

        if (result.response === 1) {
          displayResult(
            "dialogOutput",
            "✅ 用户点击了【确定】\n可以继续执行删除操作"
          );
        } else {
          displayResult(
            "dialogOutput",
            "❌ 用户点击了【取消】\n操作已取消"
          );
        }
      } catch (error) {
        displayError("dialogOutput", error);
      }
    }

    // ==================== 输入模拟 API 测试 ====================
    async function testInputPasteText() {
      try {
        const text = document.getElementById("inputText").value;
        await window.naimo.input.pasteText(text);
        displayResult(
          "inputOutput",
          "文本已粘贴（请将焦点移到其他应用查看效果）"
        );
      } catch (error) {
        displayError("inputOutput", error);
      }
    }

    async function testInputSimulateKeyPress() {
      try {
        const key = document.getElementById("inputKey").value;
        await window.naimo.input.simulateKeyPress(key);
        displayResult("inputOutput", `已模拟按键: ${key}`);
      } catch (error) {
        displayError("inputOutput", error);
      }
    }

    // ==================== 综合示例 ====================

    // 运行综合示例：演示多个API的组合使用
    async function runComprehensiveExample() {
      const output = document.getElementById("comprehensiveOutput");
      output.style.display = "block";
      output.className = "output success";

      let log = "🚀 开始运行综合示例...\n\n";

      try {
        // 1. 获取系统信息
        log += "📍 步骤 1: 获取系统信息\n";
        const version = await window.naimo.system.getVersion();
        const isWindows = await window.naimo.system.isWindows();
        const deviceId = await window.naimo.system.getDeviceId();
        log += `  ✓ 应用版本: ${version}\n`;
        log += `  ✓ 操作系统: ${isWindows ? "Windows" : "其他"}\n`;
        log += `  ✓ 设备ID: ${deviceId}\n\n`;

        // 2. 保存用户配置到数据库
        log += "📍 步骤 2: 保存用户配置到数据库\n";
        const userConfig = {
          _id: "demo_user_config",
          username: "demo_user",
          preferences: {
            theme: "dark",
            language: "zh-CN",
            notifications: true
          },
          deviceId: deviceId,
          lastLogin: new Date().toISOString()
        };
        const dbResult = await window.naimo.db.put(userConfig);
        log += `  ✓ 配置已保存: ${dbResult.id}\n`;
        log += `  ✓ 版本号: ${dbResult.rev}\n\n`;

        // 3. 保存简单配置到键值存储
        log += "📍 步骤 3: 保存快捷键到键值存储\n";
        await window.naimo.storage.setItem("last_opened", new Date().toISOString());
        await window.naimo.storage.setItem("launch_count", "1");
        log += `  ✓ 启动时间已记录\n\n`;

        // 4. 复制配置信息到剪贴板
        log += "📍 步骤 4: 复制配置信息到剪贴板\n";
        const configText = JSON.stringify(userConfig, null, 2);
        await window.naimo.clipboard.writeText(configText);
        log += `  ✓ 配置已复制到剪贴板\n\n`;

        // 5. 发送成功通知
        log += "📍 步骤 5: 发送系统通知\n";
        await window.naimo.system.notify(
          "综合示例执行成功！配置已保存并复制到剪贴板。",
          "Naimo Tools"
        );
        log += `  ✓ 通知已发送\n\n`;

        // 6. 获取保存的配置并验证
        log += "📍 步骤 6: 验证保存的配置\n";
        const savedConfig = await window.naimo.db.get("demo_user_config");
        const lastOpened = await window.naimo.storage.getItem("last_opened");
        log += `  ✓ 数据库配置验证: ${savedConfig ? "成功" : "失败"}\n`;
        log += `  ✓ 键值存储验证: ${lastOpened ? "成功" : "失败"}\n\n`;

        log += "✅ 综合示例执行完成！\n\n";
        log += "💡 提示：\n";
        log += "  • 配置已保存到数据库（文档ID: demo_user_config）\n";
        log += "  • 启动时间已保存到键值存储\n";
        log += "  • 配置信息已复制到剪贴板（可直接粘贴）\n";
        log += "  • 系统通知已发送\n";

        output.textContent = log;

      } catch (error) {
        log += `\n❌ 执行失败: ${error.message}`;
        output.className = "output error";
        output.textContent = log;
      }
    }

    // 显示API文档
    function showApiDocs() {
      const output = document.getElementById("comprehensiveOutput");
      output.style.display = "block";
      output.className = "output";

      const docs = `
📚 Naimo API 文档

═══════════════════════════════════════════════════

🪟 窗口管理 (naimo.window)
────────────────────────────────────────────────
• hide()                    - 隐藏当前窗口
• show()                    - 显示当前窗口
• close()                   - 关闭当前窗口
• minimize()                - 最小化窗口
• maximize()                - 最大化/还原窗口
• setHeight(height)         - 设置窗口高度
• setSize(width, height)    - 设置窗口尺寸
• create(url, options)      - 创建新窗口

═══════════════════════════════════════════════════

💾 文档数据库 (naimo.db) - 基于 lowdb
────────────────────────────────────────────────
• put(doc)                  - 保存/更新文档（需要 _id）
• get(id)                   - 获取文档
• remove(id)                - 删除文档
• allDocs(prefix?)          - 获取所有文档（可按前缀过滤）
• bulkDocs(docs[])          - 批量保存文档
• putAttachment(id, data, type) - 保存附件
• getAttachment(id)         - 获取附件

💡 特点：支持 _rev 版本控制，每个插件独立数据库

═══════════════════════════════════════════════════

🗄️ 键值存储 (naimo.storage) - 兼容 localStorage
────────────────────────────────────────────────
• setItem(key, value)       - 保存键值对
• getItem(key)              - 获取值
• removeItem(key)           - 删除键
• clear()                   - 清空所有
• getAllItems()             - 获取所有配置

💡 适用于：简单配置、缓存数据

═══════════════════════════════════════════════════

📋 剪贴板 (naimo.clipboard)
────────────────────────────────────────────────
• readText()                - 读取文本
• writeText(text)           - 写入文本
• readImage()               - 读取图片（base64）
• writeImage(imageData)     - 写入图片
• hasText()                 - 检查是否有文本
• hasImage()                - 检查是否有图片
• clear()                   - 清空剪贴板

═══════════════════════════════════════════════════

🐚 Shell 操作 (naimo.shell)
────────────────────────────────────────────────
• openPath(path)            - 打开文件或文件夹
• openUrl(url)              - 在浏览器中打开URL
• showInFolder(path)        - 在文件管理器中显示
• moveToTrash(path)         - 移动到回收站
• beep()                    - 播放系统提示音

═══════════════════════════════════════════════════

💻 系统信息 (naimo.system)
────────────────────────────────────────────────
• notify(message, title?)   - 发送系统通知
• getPath(name)             - 获取系统路径
  可用路径: home, desktop, documents, downloads,
           temp, appData, userData, logs
• getDeviceId()             - 获取设备唯一ID
• getVersion()              - 获取应用版本
• getName()                 - 获取应用名称
• getFileIcon(path)         - 获取文件图标
• isMac()                   - 是否Mac系统
• isWindows()               - 是否Windows系统
• isLinux()                 - 是否Linux系统

═══════════════════════════════════════════════════

🖥️ 屏幕与显示器 (naimo.screen)
────────────────────────────────────────────────
• capture(options?)         - 截图并保存
• getSources(options)       - 获取屏幕和窗口源
• getCursorPosition()       - 获取鼠标位置
• getPrimaryDisplay()       - 获取主显示器信息
• getAllDisplays()          - 获取所有显示器
• getDisplayNearestPoint(point) - 获取指定坐标的显示器
• screenToDipPoint(point)   - 屏幕坐标转DIP
• dipToScreenPoint(point)   - DIP坐标转屏幕

═══════════════════════════════════════════════════

💬 对话框 (naimo.dialog)
────────────────────────────────────────────────
• showOpen(options)         - 显示打开文件对话框
• showSave(options)         - 显示保存文件对话框
• showMessage(options)      - 显示消息框
• showError(title, content) - 显示错误对话框

═══════════════════════════════════════════════════

⌨️ 输入模拟 (naimo.input)
────────────────────────────────────────────────
• pasteText(text)           - 模拟粘贴文本
• pasteImage(imageData)     - 模拟粘贴图片
• pasteFile(filePath)       - 模拟粘贴文件
• simulateKeyPress(key)     - 模拟按键
• simulateHotkey(modifiers, key) - 模拟组合键

⚠️ 注意：输入模拟需要窗口失去焦点

═══════════════════════════════════════════════════

📝 日志系统 (naimo.log)
────────────────────────────────────────────────
• error(message, ...args)   - 记录错误
• warn(message, ...args)    - 记录警告
• info(message, ...args)    - 记录信息
• debug(message, ...args)   - 记录调试信息
• throw_error(error, options?) - 抛出错误并显示对话框

═══════════════════════════════════════════════════

📌 最佳实践：

1️⃣ 数据存储选择：
   • 复杂数据、需要查询 → 使用 db（文档数据库）
   • 简单配置、键值对    → 使用 storage（键值存储）

2️⃣ 错误处理：
   • 所有 API 调用都应该使用 try-catch
   • 使用 naimo.log.error 记录错误日志

3️⃣ 数据隔离：
   • 每个插件的数据库是独立的
   • 使用有意义的 _id 前缀组织数据

4️⃣ 性能优化：
   • 批量操作使用 bulkDocs
   • 避免频繁的 allDocs 调用
   • 使用前缀过滤减少数据传输

═══════════════════════════════════════════════════

🔗 相关资源：
   • GitHub: https://github.com/imohuan/naimo_tools
   • 文档: plugins-doc/uTools-API兼容层实施方案.md
`;

      output.textContent = docs;
    }

    // ==================== 网页自动化 API 测试 ====================

    // 简单获取 HTML
    async function testAutomationFetchHTML() {
      try {
        const url = document.getElementById("automationUrl").value;
        displayResult("automationOutput", "正在获取网页内容...");

        const result = await window.naimo.automation.fetchHTML(url);

        // 显示 HTML 的前 500 个字符
        const preview = result.html.substring(0, 500);
        const title = result.getTitle();
        const links = result.getLinks();

        displayResult(
          "automationOutput",
          `✅ 成功获取网页内容:\n\n📄 标题: ${title}\n📏 内容长度: ${result.html.length} 字符\n🔗 链接数: ${links?.length || 0}\n\n内容预览:\n${preview}...\n\n💡 提示：完整内容已记录在控制台`
        );
        console.log("完整结果:", result);
        console.log("HTML:", result.html);
        console.log("标题:", title);
        console.log("链接:", links);
      } catch (error) {
        displayError("automationOutput", error);
      }
    }

    // 获取 JSON 数据
    async function testAutomationFetchJSON() {
      try {
        displayResult("automationOutput", "正在获取 JSON 数据...");

        // 使用公开的 JSON API 进行测试
        const jsonUrl = "https://api.github.com/repos/electron/electron";

        const data = await window.naimo.automation.fetchJSON(jsonUrl);

        displayResult(
          "automationOutput",
          `✅ 成功获取 JSON 数据:\n\nURL: ${jsonUrl}\n\n数据:\n${JSON.stringify(data, null, 2).substring(0, 800)}...\n\n💡 提示：\n- 这是 Electron 仓库的信息\n- 完整数据已记录在控制台\n- 可以修改 URL 测试其他 API`
        );
        console.log("完整 JSON 数据:", data);
      } catch (error) {
        displayError("automationOutput", error);
      }
    }

    // 自动化任务示例
    async function testAutomationWithSteps() {
      try {
        displayResult("automationOutput", "正在执行自动化任务...");

        const config = {
          url: "https://www.example.com",
          show: true, // 显示浏览器窗口
          timeout: 15000,
          steps: [
            // 等待页面加载
            { action: "waitForSelector", args: ["h1"] },
            // 等待 1 秒
            { action: "waitForTimeout", args: [1000] }
          ]
        };

        const html = await window.naimo.automation.automateWithJson(config);

        const preview = html.substring(0, 500);
        displayResult(
          "automationOutput",
          `✅ 自动化任务执行完成:\n\n配置:\n${JSON.stringify(config, null, 2)}\n\n获取到的内容 (前 500 字符):\n${preview}...`
        );
        console.log("完整 HTML:", html);
      } catch (error) {
        displayError("automationOutput", error);
      }
    }

    // 百度搜索示例
    async function testAutomationSearch() {
      try {
        displayResult("automationOutput", "正在执行百度搜索...");

        const config = {
          url: "https://www.baidu.com",
          show: true,
          timeout: 20000,
          steps: [
            // 等待搜索框加载
            { action: "waitForSelector", args: ["#kw"] },
            // 在搜索框输入内容
            { action: "type", args: ["#kw", "Electron 教程"] },
            // 等待一下
            { action: "waitForTimeout", args: [500] },
            // 点击搜索按钮
            { action: "click", args: ["#su"] },
            // 等待结果加载
            { action: "waitForTimeout", args: [2000] }
          ]
        };

        const html = await window.naimo.automation.automateWithJson(config);

        displayResult(
          "automationOutput",
          `✅ 百度搜索任务执行完成!\n\n搜索关键词: Electron 教程\n获取到的内容长度: ${html.length} 字符\n\n💡 提示：\n- 已在新窗口中演示搜索过程\n- 完整结果已记录在控制台`
        );
        console.log("搜索结果 HTML:", html);
      } catch (error) {
        displayError("automationOutput", error);
      }
    }

    // ==================== 网页自动化实用案例 ====================

    // 案例1: 获取网页标题
    async function testAutomationUseCaseGetTitle() {
      try {
        const url = document.getElementById("automationUrl").value || "https://www.baidu.com";
        displayResult("automationOutput", `正在获取 ${url} 的标题...`);

        const config = {
          url: url,
          show: true,
          timeout: 10000,
          steps: [
            { action: "waitForTimeout", args: [1000] }
          ]
        };

        const html = await window.naimo.automation.automateWithJson(config);

        // 从 HTML 中提取标题
        const titleMatch = html.match(/<title>(.*?)<\/title>/i);
        const title = titleMatch ? titleMatch[1] : "未找到标题";

        displayResult(
          "automationOutput",
          `✅ 网页标题获取成功:\n\nURL: ${url}\n标题: ${title}`
        );
      } catch (error) {
        displayError("automationOutput", error);
      }
    }

    // 案例2: API 数据获取（fetchJSON + fetchHTML 结合使用）
    async function testAutomationUseCaseAPIData() {
      try {
        displayResult("automationOutput", "正在演示 API 数据获取...");

        // 获取 GitHub 仓库信息
        const repoData = await window.naimo.automation.fetchJSON(
          "https://api.github.com/repos/electron/electron"
        );

        // 获取 GitHub 主页（演示 fetchHTML）
        const htmlResult = await window.naimo.automation.fetchHTML(
          "https://github.com/electron/electron"
        );

        displayResult(
          "automationOutput",
          `✅ API 数据获取完成:\n\n📊 JSON API 数据 (fetchJSON):\n- 仓库名: ${repoData.name}\n- 描述: ${repoData.description}\n- Star 数: ${repoData.stargazers_count}\n- Fork 数: ${repoData.forks_count}\n- 开源协议: ${repoData.license?.name}\n\n📄 HTML 数据 (fetchHTML):\n- 页面标题: ${htmlResult.getTitle()}\n- 链接数量: ${htmlResult.getLinks()?.length || 0}\n\n💡 应用场景:\n- API 数据聚合\n- 网页内容分析\n- 数据对比验证\n- 多源数据整合`
        );
        console.log("JSON 数据:", repoData);
        console.log("HTML 结果:", htmlResult);
      } catch (error) {
        displayError("automationOutput", error);
      }
    }

    // 案例3: 百度搜索自动化（完整流程 + 实时操作展示）
    async function testAutomationUseCaseLogin() {
      try {
        displayResult("automationOutput", "正在执行百度搜索自动化任务...\n\n📊 操作状态将实时展示在页面上");

        const searchKeyword = "Electron 桌面应用开发";

        const config = {
          url: "https://www.baidu.com",
          show: true,
          timeout: 20000,
          requestInterception: {
            enabled: true,
            regex: [
              /\.(png|jpg|jpeg|gif|svg|webp|ico)$/i,
              /\.(woff2?|ttf|eot)$/i
            ]
          },
          steps: [
            // 步骤 1: 等待搜索框加载
            { action: "waitForSelector", args: ["#kw", { timeout: 5000 }] },
            {
              action: "evaluate",
              args: [`
                const status = document.createElement('div');
                status.id = 'automation-status';
                status.style.cssText = 'position:fixed;top:20px;right:20px;background:rgba(0,0,0,0.8);color:#fff;padding:20px;border-radius:8px;font-size:16px;z-index:9999;max-width:300px;';
                status.innerHTML = '✅ 步骤 1/5: 页面加载完成';
                document.body.appendChild(status);
              `]
            },
            { action: "waitForTimeout", args: [800] },

            // 步骤 2: 清空搜索框
            { action: "waitForSelector", args: ["#kw", { timeout: 5000 }] },
            { action: "click", args: ["#kw"] },
            { action: "evaluate", args: [`document.querySelector('#kw').value = '';`] },
            {
              action: "evaluate",
              args: [`document.querySelector('#automation-status').innerHTML = '✅ 步骤 2/5: 搜索框已清空';`]
            },
            { action: "waitForTimeout", args: [500] },

            // 步骤 3: 输入搜索关键词
            { action: "type", args: ["#kw", searchKeyword, { delay: 100 }] },
            {
              action: "evaluate",
              args: [`document.querySelector('#automation-status').innerHTML = '✅ 步骤 3/5: 正在输入搜索词<br>"${searchKeyword}"';`]
            },
            { action: "waitForTimeout", args: [800] },

            // 步骤 4: 点击搜索按钮
            {
              action: "evaluate",
              args: [`document.querySelector('#automation-status').innerHTML = '✅ 步骤 4/5: 准备搜索...';`]
            },
            { action: "waitForTimeout", args: [500] },
            { action: "click", args: ["#su"] },

            // 步骤 5: 等待搜索结果加载
            { action: "waitForSelector", args: ["#content_left", { timeout: 5000 }] },
            {
              action: "evaluate",
              args: [`document.querySelector('#automation-status').innerHTML = '✅ 步骤 5/5: 搜索完成！<br><br>找到搜索结果';`]
            },
            { action: "waitForTimeout", args: [1500] },

            // 步骤 6: 提取搜索结果
            {
              action: "evaluate",
              args: [`
                const results = Array.from(document.querySelectorAll('#content_left .result')).slice(0, 5).map((item, index) => {
                  const title = item.querySelector('h3')?.innerText || '无标题';
                  const link = item.querySelector('h3 a')?.href || '';
                  return { index: index + 1, title, link };
                });
                
                document.querySelector('#automation-status').innerHTML = 
                  '<strong>🎉 搜索完成！</strong><br><br>' +
                  '<strong>关键词：</strong>"${searchKeyword}"<br>' +
                  '<strong>结果数：</strong>' + results.length + ' 条<br><br>' +
                  '<strong>前 ' + results.length + ' 条结果：</strong><br>' +
                  results.map(r => (r.index + '. ' + r.title.substring(0, 30) + '...')).join('<br>');
                
                // 返回结果
                return results;
              `]
            },
            { action: "waitForTimeout", args: [2000] }
          ]
        };

        const html = await window.naimo.automation.automateWithJson(config);

        displayResult(
          "automationOutput",
          `✅ 百度搜索自动化任务完成！\n\n📝 任务详情:\n- 搜索关键词: "${searchKeyword}"\n- 执行步骤: 6 步\n- 总耗时: ~8秒\n\n✨ 亮点功能:\n1. 实时状态展示 - 使用 evaluate 在页面上显示当前操作\n2. 资源拦截优化 - 拦截图片和字体，提升速度\n3. 模拟真实操作 - 带延迟的输入，更像真人\n4. 数据提取 - 自动提取前5条搜索结果\n5. 视觉反馈 - 浮动状态框实时更新\n\n💡 完整 HTML 长度: ${html.length} 字符\n\n🔍 技术要点:\n- waitForSelector: 等待元素加载\n- type: 模拟键盘输入\n- click: 模拟鼠标点击\n- evaluate: 执行自定义 JS 代码\n- requestInterception: 拦截不需要的资源`
        );
        console.log("百度搜索结果 HTML:", html);
      } catch (error) {
        displayError("automationOutput", error);
      }
    }

    // 案例4: B站番剧索引爬取（fetchHTML + parseHtmlByConfig）
    async function testAutomationUseCaseDataCrawl() {
      try {
        displayResult("automationOutput", "正在爬取 B站番剧索引页面数据...\n\n⏳ 请稍候，正在获取页面...");

        const bilibiliUrl = "https://www.bilibili.com/anime/index/?from_spmid=666.4.index.0#st=1&order=3&season_version=-1&spoken_language_type=-1&area=-1&is_finish=-1&copyright=-1&season_status=-1&season_month=-1&year=-1&style_id=-1&sort=0&page=1";

        // 方案 1: 使用 fetchHTML + parseHtmlByConfig
        const result = await window.naimo.automation.fetchHTML(bilibiliUrl, {
          show: true,
          timeout: 15000,
          requestInterception: {
            enabled: true,
            regex: [
              /\.(png|jpg|jpeg|gif|svg|webp|ico)$/i,
              /\.(css|woff2?|ttf|eot)$/i,
              /\.(mp4|webm|ogg)$/i
            ]
          },
          steps: [
            // 等待番剧列表加载
            { action: "waitForSelector", args: [".bangumi-list", { timeout: 10000 }] },
            { action: "waitForTimeout", args: [2000] },
            // 在页面上显示爬取状态
            {
              action: "evaluate",
              args: [`
                const status = document.createElement('div');
                status.style.cssText = 'position:fixed;top:20px;right:20px;background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;padding:20px;border-radius:12px;font-size:16px;z-index:9999;box-shadow:0 4px 20px rgba(0,0,0,0.3);';
                status.innerHTML = '<strong>🚀 数据爬取中...</strong><br><br>正在提取番剧信息';
                document.body.appendChild(status);
              `]
            },
            { action: "waitForTimeout", args: [1000] }
          ]
        });

        // 使用 parseHtmlByConfig 解析 HTML
        const parseConfig = {
          name: "bangumiList",
          cls: "@.bangumi-item",
          children: [
            {
              name: "title",
              cls: ".bangumi-title::text"
            },
            {
              name: "link",
              cls: ".bangumi-title::attr(href)"
            },
            {
              name: "followers",
              cls: ".shadow::text"
            },
            {
              name: "tag",
              cls: ".corner-tag::text"
            },
            {
              name: "episodes",
              cls: ".pub-info::text"
            }
          ]
        };

        const bangumiData = window.naimo.automation.parseHtmlByConfig(parseConfig, result.html);

        displayResult(
          "automationOutput",
          `✅ B站番剧数据爬取完成！\n\n📊 爬取统计:\n- 页面标题: ${result.getTitle()}\n- 番剧数量: ${bangumiData?.length || 0} 部\n- HTML 大小: ${result.html.length} 字符\n\n🎬 前 5 部番剧信息:\n${bangumiData?.slice(0, 5).map((item, idx) =>
            `\n${idx + 1}. ${item.title || '无标题'}\n   追番: ${item.followers || '未知'}\n   标签: ${item.tag || '无'}\n   状态: ${item.episodes || '未知'}`
          ).join('\n') || '无数据'}\n\n✨ 技术亮点:\n\n1️⃣ fetchHTML - 智能获取页面\n   • 支持自动化配置\n   • 等待动态内容加载\n   • 资源拦截优化速度\n\n2️⃣ parseHtmlByConfig - 结构化解析\n   • CSS 选择器定位\n   • ::text 提取文本\n   • ::attr() 提取属性\n   • children 嵌套解析\n   • @ 前缀批量提取\n\n3️⃣ 数据结构化\n   • 自动提取番剧列表\n   • 包含标题、链接、追番数等\n   • 返回 JSON 格式数据\n\n💡 完整数据已记录在控制台\n\n📝 解析配置:\n${JSON.stringify(parseConfig, null, 2)}`
        );

        console.log("=== B站番剧爬取结果 ===");
        console.log("📄 页面标题:", result.getTitle());
        console.log("📊 番剧数据:", bangumiData);
        console.log("📏 HTML 长度:", result.html.length);
        console.log("🔗 所有链接数:", result.getLinks()?.length);
        console.log("\n📋 完整番剧列表:");
        console.table(bangumiData?.slice(0, 10));

      } catch (error) {
        displayError("automationOutput", error);
        console.error("爬取失败:", error);
      }
    }

    // ==================== UBrowser API 测试 ====================

    // 基础示例 - 打开网页并获取标题
    async function testUBrowserBasic() {
      try {
        displayResult("ubrowserOutput", "正在运行 UBrowser 基础示例...");

        const result = await window.naimo.ubrowser
          .goto("https://www.baidu.com")
          .wait("#kw")
          .evaluate(`document.title`)
          .run({ width: 1000, height: 700 });

        // result 是一个数组，最后一个元素是 BrowserInstance
        const title = result[0]; // evaluate 的返回值
        const instance = result[result.length - 1]; // BrowserInstance

        displayResult(
          "ubrowserOutput",
          `✅ UBrowser 基础示例运行完成！

📋 链式调用:
window.naimo.ubrowser
  .goto("https://www.baidu.com")
  .wait("#kw")
  .evaluate(() => document.title)
  .run({ width: 1000, height: 700 })

🎯 执行结果:
- 页面标题: ${title}
- 窗口 ID: ${instance.id}
- URL: ${instance.url}
- 窗口大小: ${instance.width} x ${instance.height}

💡 特点:
1. 优雅的链式调用
2. 自动等待元素加载
3. 执行自定义 JS
4. 返回窗口实例信息`
        );
        console.log("UBrowser 结果:", result);
      } catch (error) {
        displayError("ubrowserOutput", error);
      }
    }

    // 百度搜索示例
    async function testUBrowserSearch() {
      try {
        displayResult("ubrowserOutput", "正在执行百度搜索...");

        const searchKeyword = "Electron 开发";

        const result = await window.naimo.ubrowser
          .goto("https://www.baidu.com")
          .wait("#kw")
          .value("#kw", searchKeyword)
          .wait(300)
          .press("enter")
          .wait("#content_left", 5000)
          .evaluate(`
            Array.from(document.querySelectorAll('#content_left .result'))
              .slice(0, 5)
              .map((item, index) => {
                const title = item.querySelector('h3')?.innerText || '无标题';
                const link = item.querySelector('h3 a')?.href || '';
                return { index: index + 1, title, link };
              })
          `)
          .run({ width: 1200, height: 800 });

        const searchResults = result[0]; // evaluate 返回的搜索结果

        displayResult(
          "ubrowserOutput",
          `✅ 百度搜索完成！

🔍 搜索关键词: "${searchKeyword}"

📋 前 5 条结果:
${searchResults.map(r => `${r.index}. ${r.title.substring(0, 60)}...`).join('\n')}

💡 链式调用流程:
.goto() → 打开网页
.wait() → 等待搜索框
.value() → 输入关键词
.press() → 按回车键
.wait() → 等待结果加载
.evaluate() → 提取结果数据
.run() → 执行任务

✨ 完整结果已记录在控制台`
        );
        console.log("搜索结果:", searchResults);
      } catch (error) {
        displayError("ubrowserOutput", error);
      }
    }

    // 快递查询示例
    async function testUBrowserExpressQuery() {
      try {
        displayResult("ubrowserOutput", "正在查询快递信息...");

        const expressNo = "YT8933937901850";

        const result = await window.naimo.ubrowser
          .goto("https://www.kuaidi100.com/")
          .wait("#input")
          .scroll(0, 450)
          .value("#input", expressNo)
          .click("#query")
          .wait(2000)
          .run({ width: 1280, height: 720 });

        const instance = result[result.length - 1];

        displayResult(
          "ubrowserOutput",
          `✅ 快递查询完成！

📦 快递单号: ${expressNo}
🌐 查询网站: 快递100
📊 窗口信息:
  - ID: ${instance.id}
  - URL: ${instance.url}
  - 大小: ${instance.width} x ${instance.height}

💡 链式调用流程:
.goto() → 打开快递100
.wait() → 等待输入框
.scroll() → 滚动到合适位置
.value() → 输入快递单号
.click() → 点击查询按钮
.wait() → 等待结果加载
.run() → 执行任务

✨ 实际应用场景:
- 快递批量查询
- 自动化物流跟踪
- 快递信息聚合`
        );
        console.log("UBrowser 实例:", instance);
      } catch (error) {
        displayError("ubrowserOutput", error);
      }
    }

    // 网页截图示例
    async function testUBrowserScreenshot() {
      try {
        displayResult("ubrowserOutput", "正在截取网页...");

        const result = await window.naimo.ubrowser
          .goto("https://www.baidu.com")
          .wait("#kw")
          .wait(1000)
          .screenshot()
          .run({ width: 1200, height: 800 });

        const screenshot = result[0]; // screenshot 返回的 Buffer

        displayResult(
          "ubrowserOutput",
          `✅ 网页截图完成！

📸 截图信息:
  - 类型: Buffer
  - 大小: ${screenshot?.length || 0} 字节
  - 格式: PNG

💡 链式调用流程:
.goto() → 打开网页
.wait() → 等待页面加载
.screenshot() → 截取整页
.run() → 执行任务

✨ 实际应用场景:
- 网页归档
- 自动化测试
- 内容快照
- 视觉回归测试

📝 注意: 截图数据已记录在控制台`
        );
        console.log("截图 Buffer:", screenshot);
      } catch (error) {
        displayError("ubrowserOutput", error);
      }
    }

    // 条件判断示例
    async function testUBrowserCondition() {
      try {
        displayResult("ubrowserOutput", "正在演示条件判断...");

        const result = await window.naimo.ubrowser
          .goto("https://www.baidu.com")
          .wait("#kw")
          // 判断是否存在登录按钮
          .when("#s-top-loginbtn")
          .evaluate(`
            const btn = document.querySelector("#s-top-loginbtn");
            if (btn) btn.style.border = "2px solid red";
            "找到登录按钮"
          `)
          .end()
          // 判断是否存在搜索框
          .when("#kw")
          .evaluate(`
            const input = document.querySelector("#kw");
            if (input) input.style.border = "2px solid green";
            "找到搜索框"
          `)
          .end()
          .wait(2000)
          .run({ width: 1000, height: 700 });

        displayResult(
          "ubrowserOutput",
          `✅ 条件判断示例完成！

🎯 条件分支语法:
.when(selector)
  .操作1()
  .操作2()
.end()

📊 执行结果:
${result.slice(0, -1).map((r, i) => `  ${i + 1}. ${r}`).join('\n')}

💡 链式调用流程:
.goto() → 打开网页
.wait() → 等待加载
.when() → 判断元素是否存在
  .evaluate() → 存在时执行操作
.end() → 结束条件分支
.run() → 执行任务

✨ 实际应用场景:
- 页面状态检测
- 登录状态判断
- 元素存在性验证
- 智能化流程控制`
        );
        console.log("条件判断结果:", result);
      } catch (error) {
        displayError("ubrowserOutput", error);
      }
    }

    // ==================== UBrowser 即时执行模式测试 ====================

    // 全局浏览器实例
    let instantBrowser = null;

    // 步骤 1: 打开网页
    async function testInstantStep1() {
      try {
        displayResult("instantOutput", "⏳ 正在打开网页...");

        // 创建浏览器实例
        instantBrowser = window.naimo.instantBrowser.create();

        // 打开网页
        const info = await instantBrowser.goto("https://www.baidu.com", {
          width: 1200,
          height: 800
        });

        displayResult(
          "instantOutput",
          `✅ 步骤 1 完成：网页已打开

📊 浏览器信息:
  - ID: ${info.id}
  - URL: ${info.url}
  - 窗口大小: ${info.width} x ${info.height}

💡 提示：点击"② 等待元素"继续下一步`
        );
        console.log("浏览器信息:", info);
      } catch (error) {
        displayError("instantOutput", error);
      }
    }

    // 步骤 2: 等待元素
    async function testInstantStep2() {
      try {
        if (!instantBrowser) {
          throw new Error("请先点击\"① 打开网页\"");
        }

        displayResult("instantOutput", "⏳ 正在等待搜索框加载...");

        await instantBrowser.wait("#kw");

        displayResult(
          "instantOutput",
          `✅ 步骤 2 完成：搜索框已就绪

📋 执行的操作:
  - 等待选择器: #kw
  - 等待超时: 30秒

💡 提示：点击"③ 输入文本"继续下一步`
        );
      } catch (error) {
        displayError("instantOutput", error);
      }
    }

    // 步骤 3: 输入文本
    async function testInstantStep3() {
      try {
        if (!instantBrowser) {
          throw new Error("请先点击\"① 打开网页\"");
        }

        const keyword = "Electron 开发教程";
        displayResult("instantOutput", `⏳ 正在输入搜索关键词: "${keyword}"...`);

        await instantBrowser.value("#kw", keyword);
        await instantBrowser.wait(500);

        displayResult(
          "instantOutput",
          `✅ 步骤 3 完成：文本已输入

📝 输入内容:
  - 选择器: #kw
  - 关键词: "${keyword}"

💡 提示：点击"④ 点击搜索"继续下一步`
        );
      } catch (error) {
        displayError("instantOutput", error);
      }
    }

    // 步骤 4: 点击搜索
    async function testInstantStep4() {
      try {
        if (!instantBrowser) {
          throw new Error("请先点击\"① 打开网页\"");
        }

        displayResult("instantOutput", "⏳ 正在点击搜索按钮...");

        await instantBrowser.press("enter");
        await instantBrowser.wait("#content_left", 10000);

        displayResult(
          "instantOutput",
          `✅ 步骤 4 完成：搜索已执行

📋 执行的操作:
  - 按键: Enter
  - 等待结果区域: #content_left
  - 超时时间: 10秒

💡 提示：点击"⑤ 提取结果"查看搜索结果`
        );
      } catch (error) {
        displayError("instantOutput", error);
      }
    }

    // 步骤 5: 提取结果
    async function testInstantStep5() {
      try {
        if (!instantBrowser) {
          throw new Error("请先点击\"① 打开网页\"");
        }

        displayResult("instantOutput", "⏳ 正在提取搜索结果...");

        const results = await instantBrowser.evaluate(() => {
          return Array.from(document.querySelectorAll('#content_left .result'))
            .slice(0, 5)
            .map((item, index) => {
              const title = item.querySelector('h3')?.innerText || '无标题';
              const link = item.querySelector('h3 a')?.href || '';
              return { index: index + 1, title, link };
            });
        });

        displayResult(
          "instantOutput",
          `✅ 步骤 5 完成：结果已提取

📊 搜索结果 (前 5 条):
${results.map(r => `${r.index}. ${r.title.substring(0, 50)}...`).join('\n')}

💡 完整结果已记录在控制台
💡 点击"关闭浏览器"结束测试`
        );
        console.log("搜索结果:", results);
      } catch (error) {
        displayError("instantOutput", error);
      }
    }

    // 关闭浏览器
    async function testInstantClose() {
      try {
        if (!instantBrowser) {
          displayResult("instantOutput", "⚠️ 浏览器已关闭或未创建");
          return;
        }

        displayResult("instantOutput", "⏳ 正在关闭浏览器...");

        await instantBrowser.close();
        instantBrowser = null;

        displayResult(
          "instantOutput",
          `✅ 浏览器已关闭

💡 可以重新点击"① 打开网页"开始新的测试`
        );
      } catch (error) {
        displayError("instantOutput", error);
        instantBrowser = null;
      }
    }

    // ==================== 本地测试页面自动化 ====================

    const TEST_URL = "http://localhost:8000/test.html";

    // ========== 模式1: automateWithJson (配置模式) ==========

    // 测试登录表单
    async function testLocalAutomateLogin() {
      try {
        displayResult("localAutomateOutput", "正在测试登录表单...");

        const config = {
          url: TEST_URL,
          show: true,
          timeout: 15000,
          steps: [
            // 等待页面加载
            { action: "waitForSelector", args: ["#username"] },
            { action: "waitForTimeout", args: [500] },

            // 填写用户名
            { action: "type", args: ["#username", "test_user", { delay: 50 }] },
            { action: "waitForTimeout", args: [300] },

            // 填写密码
            { action: "type", args: ["#password", "test_pass123", { delay: 50 }] },
            { action: "waitForTimeout", args: [300] },

            // 勾选记住我
            { action: "click", args: ["#remember"] },
            { action: "waitForTimeout", args: [300] },

            // 点击登录按钮
            { action: "click", args: ["#loginForm button[type='submit']"] },
            { action: "waitForTimeout", args: [1000] },

            // 获取结果
            { action: "evaluate", args: [`document.querySelector('#loginResult').textContent`] }
          ]
        };

        const html = await window.naimo.automation.automateWithJson(config);

        displayResult(
          "localAutomateOutput",
          `✅ 登录表单测试完成！\n\n🎯 配置模式 (automateWithJson)\n执行步骤: ${config.steps.length} 步\n\n💡 特点:\n• 完全基于JSON配置\n• 步骤清晰可保存\n• 任务完成后自动关闭窗口\n\n📝 完整HTML长度: ${html.length} 字符`
        );
        console.log("登录测试结果:", html);
      } catch (error) {
        displayError("localAutomateOutput", error);
      }
    }

    // 测试搜索功能
    async function testLocalAutomateSearch() {
      try {
        displayResult("localAutomateOutput", "正在测试搜索功能...");

        const config = {
          url: TEST_URL,
          show: true,
          timeout: 15000,
          steps: [
            { action: "waitForSelector", args: ["#searchInput"] },
            { action: "waitForTimeout", args: [500] },

            // 输入搜索关键词
            { action: "type", args: ["#searchInput", "Electron", { delay: 80 }] },
            { action: "waitForTimeout", args: [300] },

            // 点击搜索按钮
            { action: "click", args: ["#searchBtn"] },
            { action: "waitForTimeout", args: [1500] },

            // 获取搜索结果
            {
              action: "evaluate", args: [`
              Array.from(document.querySelectorAll('#searchList li')).map(li => li.textContent)
            `]
            }
          ]
        };

        const html = await window.naimo.automation.automateWithJson(config);

        displayResult(
          "localAutomateOutput",
          `✅ 搜索功能测试完成！\n\n🔍 搜索关键词: Electron\n执行步骤: ${config.steps.length} 步\n\n完整HTML长度: ${html.length} 字符`
        );
        console.log("搜索测试结果:", html);
      } catch (error) {
        displayError("localAutomateOutput", error);
      }
    }

    // 测试数据表单
    async function testLocalAutomateForm() {
      try {
        displayResult("localAutomateOutput", "正在测试数据表单...");

        const config = {
          url: TEST_URL,
          show: true,
          timeout: 20000,
          steps: [
            { action: "waitForSelector", args: ["#name"] },
            { action: "waitForTimeout", args: [500] },

            // 填写姓名
            { action: "type", args: ["#name", "张三", { delay: 80 }] },
            { action: "waitForTimeout", args: [200] },

            // 填写邮箱
            { action: "type", args: ["#email", "zhangsan@example.com", { delay: 60 }] },
            { action: "waitForTimeout", args: [200] },

            // 填写年龄
            { action: "type", args: ["#age", "25", { delay: 100 }] },
            { action: "waitForTimeout", args: [200] },

            // 选择城市
            { action: "select", args: ["#city", "beijing"] },
            { action: "waitForTimeout", args: [200] },

            // 勾选兴趣爱好
            { action: "click", args: ["#hobby1"] },
            { action: "waitForTimeout", args: [100] },
            { action: "click", args: ["#hobby3"] },
            { action: "waitForTimeout", args: [100] },

            // 填写备注
            { action: "type", args: ["#comment", "这是自动化测试填写的备注信息", { delay: 50 }] },
            { action: "waitForTimeout", args: [300] },

            // 提交表单
            { action: "click", args: ["#dataForm button[type='submit']"] },
            { action: "waitForTimeout", args: [1000] }
          ]
        };

        const html = await window.naimo.automation.automateWithJson(config);

        displayResult(
          "localAutomateOutput",
          `✅ 数据表单测试完成！\n\n📋 表单字段:\n• 姓名: 张三\n• 邮箱: zhangsan@example.com\n• 年龄: 25\n• 城市: 北京\n• 兴趣: 阅读、音乐\n• 备注: 已填写\n\n执行步骤: ${config.steps.length} 步`
        );
        console.log("表单测试结果:", html);
      } catch (error) {
        displayError("localAutomateOutput", error);
      }
    }

    // ========== 模式2: UBrowser (链式调用) ==========

    // 链式-登录表单
    async function testLocalUBrowserLogin() {
      try {
        displayResult("localUBrowserOutput", "正在执行链式登录...");

        const result = await window.naimo.ubrowser
          .goto(TEST_URL)
          .wait("#username")
          .wait(500)
          .type("#username", "chain_user", { delay: 50 })
          .wait(300)
          .type("#password", "chain_pass456", { delay: 50 })
          .wait(300)
          .click("#remember")
          .wait(300)
          .click("#loginForm button[type='submit']")
          .wait(1000)
          .evaluate(`document.querySelector('#loginResult').textContent`)
          .run({ width: 1000, height: 700 });

        const loginResult = result[0]; // evaluate 的返回值
        const instance = result[result.length - 1];

        displayResult(
          "localUBrowserOutput",
          `✅ 链式登录完成！\n\n📝 链式调用语法:\nubrowser\n  .goto(url)\n  .wait(selector)\n  .type(selector, text)\n  .click(selector)\n  .evaluate(func)\n  .run(options)\n\n🎯 执行结果:\n登录信息: ${loginResult}\n窗口ID: ${instance.id}\n\n💡 优点:\n• API 优雅流畅\n• 代码可读性高\n• 统一执行所有步骤`
        );
        console.log("链式登录结果:", result);
      } catch (error) {
        displayError("localUBrowserOutput", error);
      }
    }

    // 链式-搜索功能
    async function testLocalUBrowserSearch() {
      try {
        displayResult("localUBrowserOutput", "正在执行链式搜索...");

        const result = await window.naimo.ubrowser
          .goto(TEST_URL)
          .wait("#searchInput")
          .wait(500)
          .type("#searchInput", "JavaScript", { delay: 80 })
          .wait(300)
          .click("#searchBtn")
          .wait(1500)
          .evaluate(`
            Array.from(document.querySelectorAll('#searchList li'))
              .map(li => li.textContent)
          `)
          .run({ width: 1200, height: 800 });

        const searchResults = result[0];

        displayResult(
          "localUBrowserOutput",
          `✅ 链式搜索完成！\n\n🔍 搜索关键词: JavaScript\n📊 结果数量: ${searchResults?.length || 0}\n\n搜索结果:\n${searchResults?.join('\n') || '无'}\n\n💡 链式调用流程:\n.goto() → .wait() → .type() → .click() → .evaluate() → .run()`
        );
        console.log("链式搜索结果:", searchResults);
      } catch (error) {
        displayError("localUBrowserOutput", error);
      }
    }

    // 链式-复杂表单
    async function testLocalUBrowserComplex() {
      try {
        displayResult("localUBrowserOutput", "正在填写复杂表单...");

        const result = await window.naimo.ubrowser
          .goto(TEST_URL)
          .wait("#name")
          .wait(500)
          .type("#name", "李四", { delay: 80 })
          .wait(200)
          .type("#email", "lisi@example.com", { delay: 60 })
          .wait(200)
          .type("#age", "30", { delay: 100 })
          .wait(200)
          .select("#city", "shanghai")
          .wait(200)
          .click("#hobby2")
          .wait(100)
          .click("#hobby4")
          .wait(100)
          .type("#comment", "UBrowser链式调用测试", { delay: 50 })
          .wait(300)
          .screenshot()
          .run({ width: 1200, height: 900 });

        const screenshot = result[0];

        displayResult(
          "localUBrowserOutput",
          `✅ 复杂表单填写完成！\n\n📸 已截图: ${screenshot?.length || 0} 字节\n\n📋 表单内容:\n• 姓名: 李四\n• 邮箱: lisi@example.com\n• 年龄: 30\n• 城市: 上海\n• 兴趣: 运动、旅行\n• 备注: 已填写\n\n💡 技术点:\n• 多种表单元素操作\n• 页面截图功能\n• 流畅的链式调用`
        );
        console.log("表单填写结果:", result);
      } catch (error) {
        displayError("localUBrowserOutput", error);
      }
    }

    // 链式-完整流程
    async function testLocalUBrowserAll() {
      try {
        displayResult("localUBrowserOutput", "正在执行完整流程测试...");

        const result = await window.naimo.ubrowser
          .goto(TEST_URL)
          .wait("#username")

          // 步骤1: 登录
          .css(`
            #loginForm { border: 2px solid green !important; }
          `)
          .wait(500)
          .type("#username", "complete_test", { delay: 50 })
          .type("#password", "pass123", { delay: 50 })
          .click("#loginForm button[type='submit']")
          .wait(1000)

          // 步骤2: 搜索
          .scroll("#searchInput")
          .wait(500)
          .type("#searchInput", "测试", { delay: 80 })
          .click("#searchBtn")
          .wait(1500)

          // 步骤3: 填写表单
          .scroll("#name")
          .wait(500)
          .type("#name", "王五", { delay: 60 })
          .type("#email", "wangwu@test.com", { delay: 50 })

          // 步骤4: 提取所有结果
          .evaluate(`
            ({
              login: document.querySelector('#loginResult')?.textContent || '',
              search: Array.from(document.querySelectorAll('#searchList li')).map(li => li.textContent),
              time: document.querySelector('#clock')?.textContent || ''
            })
          `)
          .run({ width: 1400, height: 1000 });

        const data = result[0];

        displayResult(
          "localUBrowserOutput",
          `✅ 完整流程测试完成！\n\n🎯 执行了三个主要步骤:\n\n1️⃣ 登录表单\n${data.login}\n\n2️⃣ 搜索功能\n结果数: ${data.search?.length || 0}\n\n3️⃣ 数据填写\n已填写姓名和邮箱\n\n⏰ 页面时间: ${data.time}\n\n💡 亮点:\n• 多步骤流程自动化\n• 跨区域数据提取\n• CSS 样式注入\n• 智能滚动定位`
        );
        console.log("完整流程结果:", data);
      } catch (error) {
        displayError("localUBrowserOutput", error);
      }
    }

    // ========== 模式3: InstantBrowser (即时执行) ==========

    let localInstantBrowser = null;

    // 步骤1: 打开页面
    async function testLocalInstantStart() {
      try {
        displayResult("localInstantOutput", "⏳ 正在打开测试页面...");

        localInstantBrowser = window.naimo.instantBrowser.create();
        const info = await localInstantBrowser.goto(TEST_URL, {
          width: 1200,
          height: 900
        });

        displayResult(
          "localInstantOutput",
          `✅ 步骤1完成: 页面已打开\n\n📊 浏览器信息:\n• ID: ${info.id}\n• URL: ${info.url}\n• 大小: ${info.width} x ${info.height}\n\n💡 即时执行模式:\n每个操作立即执行\n窗口保持打开\n可以逐步调试\n\n➡️ 点击"② 填写登录"继续`
        );
        console.log("浏览器已打开:", info);
      } catch (error) {
        displayError("localInstantOutput", error);
      }
    }

    // 步骤2: 填写登录
    async function testLocalInstantLogin() {
      try {
        if (!localInstantBrowser) {
          throw new Error("请先点击\"① 打开页面\"");
        }

        displayResult("localInstantOutput", "⏳ 正在填写登录表单...");

        await localInstantBrowser.wait("#username");
        await localInstantBrowser.wait(500);
        await localInstantBrowser.type("#username", "instant_user", { delay: 50 });
        await localInstantBrowser.wait(300);
        await localInstantBrowser.type("#password", "instant123", { delay: 50 });
        await localInstantBrowser.wait(300);
        await localInstantBrowser.click("#remember");
        await localInstantBrowser.wait(300);
        await localInstantBrowser.click("#loginForm button[type='submit']");
        await localInstantBrowser.wait(1000);

        const loginResult = await localInstantBrowser.evaluate(`
          document.querySelector('#loginResult')?.textContent || ''
        `);

        displayResult(
          "localInstantOutput",
          `✅ 步骤2完成: 登录表单已提交\n\n📝 操作记录:\n• 输入用户名: instant_user\n• 输入密码: ******\n• 勾选记住我: ✓\n• 点击登录按钮: ✓\n\n📋 登录结果:\n${loginResult}\n\n➡️ 点击"③ 执行搜索"继续`
        );
        console.log("登录结果:", loginResult);
      } catch (error) {
        displayError("localInstantOutput", error);
      }
    }

    // 步骤3: 执行搜索
    async function testLocalInstantSearch() {
      try {
        if (!localInstantBrowser) {
          throw new Error("请先点击\"① 打开页面\"");
        }

        displayResult("localInstantOutput", "⏳ 正在执行搜索...");

        await localInstantBrowser.scroll("#searchInput");
        await localInstantBrowser.wait(500);
        await localInstantBrowser.type("#searchInput", "即时执行测试", { delay: 80 });
        await localInstantBrowser.wait(300);
        await localInstantBrowser.click("#searchBtn");
        await localInstantBrowser.wait(1500);

        const results = await localInstantBrowser.evaluate(`
          Array.from(document.querySelectorAll('#searchList li')).map(li => li.textContent)
        `);

        displayResult(
          "localInstantOutput",
          `✅ 步骤3完成: 搜索已执行\n\n🔍 搜索关键词: 即时执行测试\n📊 结果数量: ${results.length}\n\n搜索结果:\n${results.join('\n')}\n\n➡️ 点击"④ 填写表单"继续`
        );
        console.log("搜索结果:", results);
      } catch (error) {
        displayError("localInstantOutput", error);
      }
    }

    // 步骤4: 填写表单
    async function testLocalInstantForm() {
      try {
        if (!localInstantBrowser) {
          throw new Error("请先点击\"① 打开页面\"");
        }

        displayResult("localInstantOutput", "⏳ 正在填写数据表单...");

        await localInstantBrowser.scroll("#name");
        await localInstantBrowser.wait(500);
        await localInstantBrowser.type("#name", "赵六", { delay: 80 });
        await localInstantBrowser.wait(200);
        await localInstantBrowser.type("#email", "zhaoliu@instant.com", { delay: 60 });
        await localInstantBrowser.wait(200);
        await localInstantBrowser.type("#age", "28", { delay: 100 });
        await localInstantBrowser.wait(200);

        // 使用 evaluate 直接操作 select
        await localInstantBrowser.evaluate(`
          document.querySelector('#city').value = 'shenzhen';
        `);
        await localInstantBrowser.wait(200);

        await localInstantBrowser.click("#hobby1");
        await localInstantBrowser.wait(100);
        await localInstantBrowser.click("#hobby2");
        await localInstantBrowser.wait(100);
        await localInstantBrowser.type("#comment", "即时执行模式可以随时调整流程", { delay: 50 });
        await localInstantBrowser.wait(500);

        const screenshot = await localInstantBrowser.screenshot();

        displayResult(
          "localInstantOutput",
          `✅ 步骤4完成: 表单已填写\n\n📋 表单内容:\n• 姓名: 赵六\n• 邮箱: zhaoliu@instant.com\n• 年龄: 28\n• 城市: 深圳\n• 兴趣: 阅读、运动\n• 备注: 已填写\n\n📸 已截图: ${screenshot?.length || 0} 字节\n\n💡 即时执行模式优势:\n• 可以随时停止\n• 可以查看中间状态\n• 可以根据结果调整流程\n• 窗口保持打开便于调试\n\n➡️ 点击"⑤ 关闭浏览器"结束`
        );
        console.log("表单填写完成，截图:", screenshot);
      } catch (error) {
        displayError("localInstantOutput", error);
      }
    }

    // 步骤5: 关闭浏览器
    async function testLocalInstantClose() {
      try {
        if (!localInstantBrowser) {
          displayResult("localInstantOutput", "⚠️ 浏览器已关闭或未创建");
          return;
        }

        displayResult("localInstantOutput", "⏳ 正在关闭浏览器...");

        await localInstantBrowser.close();
        localInstantBrowser = null;

        displayResult(
          "localInstantOutput",
          `✅ 浏览器已关闭\n\n📊 即时执行模式总结:\n\n优点:\n• ✅ 灵活可控\n• ✅ 便于调试\n• ✅ 可交互\n• ✅ 可中途调整\n\n适用场景:\n• 需要人工干预的任务\n• 复杂的多步骤流程\n• 需要根据结果调整的场景\n• 开发和调试阶段\n\n💡 可以重新点击"① 打开页面"开始新的测试`
        );
      } catch (error) {
        displayError("localInstantOutput", error);
        localInstantBrowser = null;
      }
    }

    // ==================== 初始化 ====================
    window.addEventListener("DOMContentLoaded", () => {
      console.log("API 测试面板已加载");
      window.naimo.log.info("API 测试面板已初始化");
    });
  </script>
</body>

</html>