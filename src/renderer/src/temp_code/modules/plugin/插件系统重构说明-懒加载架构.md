# æ’ä»¶ç³»ç»Ÿé‡æ„è¯´æ˜ - æ‡’åŠ è½½æ¶æ„

## ğŸ“‹ é‡æ„èƒŒæ™¯

### å½“å‰é—®é¢˜

1. **ä¸»è¿›ç¨‹åŠ è½½è‡ƒè‚¿**ï¼šæ’ä»¶åœ¨åŠ è½½æ—¶ä¼šæ‰§è¡Œæ‰€æœ‰ `config.js` ä»£ç ï¼Œå¯¼è‡´ä¸»çª—å£è‡ƒè‚¿
2. **æ€§èƒ½é—®é¢˜**ï¼šæ’ä»¶è¿‡å¤šæ—¶ä¼šåŠ è½½å¤§é‡ JS ä»£ç ï¼Œå½±å“å¯åŠ¨æ€§èƒ½
3. **ç¨³å®šæ€§é£é™©**ï¼šåŠ è½½çš„ä»£ç å¯èƒ½å¯¼è‡´ä¸»è¿›ç¨‹å´©æºƒ

### è§£å†³æ–¹æ¡ˆ

**æ‡’åŠ è½½æ¶æ„**ï¼šæ’ä»¶åŠ è½½æ—¶åªè¯»å– `manifest.json` é…ç½®ï¼Œæ‰§è¡Œæ—¶æ‰åŠ è½½å¯¹åº”çš„ `preload.js` ä»£ç 

---

## ğŸ¯ æ ¸å¿ƒæ”¹åŠ¨

### 1. é…ç½®æ–‡ä»¶ç»“æ„å˜åŒ–

#### åŸæ¶æ„

```
æ’ä»¶ç›®å½•/
â”œâ”€â”€ manifest.json   # åŸºç¡€é…ç½®
â”œâ”€â”€ config.js       # åŠŸèƒ½é…ç½® + onEnter/onInstall å‡½æ•°
â””â”€â”€ preload.js      # preload è„šæœ¬
```

#### æ–°æ¶æ„

```
æ’ä»¶ç›®å½•/
â”œâ”€â”€ manifest.json   # å®Œæ•´é…ç½®ï¼ˆåŒ…å« feature + main + preloadï¼‰
â”œâ”€â”€ preload.js      # preload è„šæœ¬ + onEnter å¤„ç†å™¨æ˜ å°„
â””â”€â”€ index.html      # å¯é€‰çš„ UI é¡µé¢
```

---

## ğŸ“ manifest.json é…ç½®å˜åŒ–

### é¡¶å±‚æ–°å¢å­—æ®µ

| å­—æ®µ      | ç±»å‹   | å¿…å¡« | è¯´æ˜                                                     |
| --------- | ------ | ---- | -------------------------------------------------------- |
| `main`    | string | âŒ   | UI é¡µé¢è·¯å¾„ï¼Œæ‰€æœ‰ feature å…±ç”¨ï¼ˆå¦‚ `./index.html`ï¼‰      |
| `preload` | string | âœ…   | preload è„šæœ¬è·¯å¾„ï¼Œæ‰€æœ‰ feature å…±ç”¨ï¼ˆå¦‚ `./preload.js`ï¼‰ |
| `feature` | array  | âœ…   | åŠŸèƒ½åˆ—è¡¨ï¼ˆæ›¿ä»£åŸ config.js ä¸­çš„é…ç½®ï¼‰                    |

### feature å­—æ®µè¯´æ˜

`feature` æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæ¯ä¸ªå…ƒç´ ä»£è¡¨æ’ä»¶çš„ä¸€ä¸ªåŠŸèƒ½é¡¹

| å­—æ®µ                    | ç±»å‹     | å¿…å¡« | è¯´æ˜                                      |
| ----------------------- | -------- | ---- | ----------------------------------------- |
| `path`                  | string   | âœ…   | åŠŸèƒ½å”¯ä¸€æ ‡è¯†ï¼Œå¦‚ï¼š`text-translate`        |
| `name`                  | string   | âœ…   | åŠŸèƒ½åç§°                                  |
| `icon`                  | string   | âŒ   | åŠŸèƒ½å›¾æ ‡                                  |
| `description`           | string   | âŒ   | åŠŸèƒ½æè¿°                                  |
| `weight`                | number   | âŒ   | æƒé‡ï¼ˆå½±å“æœç´¢æ’åºï¼‰                      |
| `type`                  | string   | âŒ   | æœç´¢ç±»å‹ï¼ˆé»˜è®¤ï¼š`text`ï¼‰                  |
| `anonymousSearchFields` | string[] | âŒ   | åŒ¿åæœç´¢å­—æ®µ                              |
| `showInModes`           | string[] | âŒ   | æ˜¾ç¤ºæ¨¡å¼ï¼ˆå¦‚ `["attachment"]`ï¼‰           |
| `lifecycleType`         | string   | âŒ   | ç”Ÿå‘½å‘¨æœŸç±»å‹ï¼ˆ`new`/`reuse`/`singleton`ï¼‰ |
| `singleton`             | boolean  | âŒ   | æ˜¯å¦å•ä¾‹ï¼ˆé»˜è®¤ï¼š`true`ï¼‰                  |

**æ³¨æ„**ï¼š

- `main` å’Œ `preload` åœ¨ manifest.json **é¡¶å±‚**é…ç½®ï¼Œæ‰€æœ‰ feature å…±ç”¨
- feature ä¸­çš„ `path` åªéœ€è¦åŠŸèƒ½åç§°ï¼ˆå¦‚ `text-translate`ï¼‰ï¼Œä¸éœ€è¦å¸¦æ’ä»¶IDå‰ç¼€

### å®Œæ•´ç¤ºä¾‹

```json
{
  "id": "translate-plugin",
  "icon": "ğŸŒ",
  "name": "ç¿»è¯‘æ’ä»¶",
  "version": "1.0.0",
  "author": "Naimo Tools",
  "description": "æ™ºèƒ½æ–‡æœ¬ç¿»è¯‘å·¥å…·",
  "category": "ai_artificial_intelligence",
  "enabled": true,
  "main": "./index.html",
  "preload": "./preload.js",
  "feature": [
    {
      "path": "text-translate",
      "name": "æ–‡æœ¬ç¿»è¯‘",
      "icon": "ğŸŒ",
      "description": "æ™ºèƒ½æ–‡æœ¬ç¿»è¯‘å·¥å…·",
      "weight": 100,
      "type": "text",
      "anonymousSearchFields": ["imohuan_translate_text"],
      "lifecycleType": "reuse",
      "singleton": true
    },
    {
      "path": "quick-translate",
      "name": "å¿«é€Ÿç¿»è¯‘",
      "icon": "âš¡",
      "description": "å¿«é€Ÿç¿»è¯‘é€‰ä¸­æ–‡æœ¬",
      "weight": 90,
      "type": "text",
      "showInModes": ["attachment"],
      "lifecycleType": "new",
      "singleton": false
    }
  ],
  "settings": [
    {
      "name": "secretId",
      "title": "è…¾è®¯äº‘ Secret ID",
      "type": "input",
      "required": true
    }
  ]
}
```

---

## ğŸ”§ preload.js ç»“æ„å˜åŒ–

### åŸæ¶æ„ï¼ˆconfig.jsï¼‰

```javascript
module.exports = {
  "text-translate": {
    name: "æ–‡æœ¬ç¿»è¯‘",
    icon: "ğŸŒ",
    onEnter: async (params, api) => {
      api.openWebPageWindow(api.getResourcePath("index.html"), {
        preload: api.getResourcePath("preload.js"),
      });
    },
  },
};
```

### æ–°æ¶æ„ï¼ˆpreload.jsï¼‰

```javascript
// é»˜è®¤å¯¼å‡ºä¸€ä¸ªå¯¹è±¡ï¼Œkey ä¸º feature çš„ pathï¼Œvalue ä¸ºå¤„ç†å™¨
module.exports = {
  // path: "text-translate"ï¼ˆå¯¹åº” manifest.json ä¸­ feature çš„ pathï¼‰
  "text-translate": {
    /**
     * åŠŸèƒ½å…¥å£å‡½æ•°
     * @param {Object} params - å‚æ•°
     * @param {AttachedFile[]} params.files - é™„ä»¶æ–‡ä»¶
     * @param {string} params.searchText - æœç´¢æ–‡æœ¬
     * @param {Object} api - æ’ä»¶ API
     */
    onEnter: async (params, api) => {
      console.log("æ‰“å¼€æ–‡æœ¬ç¿»è¯‘", params);
      // å¯ä»¥åœ¨è¿™é‡Œæ‰§è¡Œè‡ªå®šä¹‰é€»è¾‘
      // manifest.json é…ç½®äº† mainï¼Œçª—å£ä¼šè‡ªåŠ¨æ‰“å¼€
      // è¿™é‡Œå¯ä»¥åšä¸€äº›åˆå§‹åŒ–å·¥ä½œ
    },
  },

  // å¿«é€Ÿç¿»è¯‘åŠŸèƒ½
  "quick-translate": {
    onEnter: async (params, api) => {
      const settings = await api.getSettingValue();
      if (!settings.secretId || !settings.secretKey) {
        console.error("è¯·å…ˆé…ç½®è…¾è®¯äº‘APIå¯†é’¥");
        return;
      }

      // è·å–è¦ç¿»è¯‘çš„æ–‡æœ¬
      let textToTranslate = params.searchText || "";

      // ç›´æ¥è°ƒç”¨ç¿»è¯‘å‡½æ•°
      const result = await translateText({
        sourceText: textToTranslate,
        source: "auto",
        target: "zh",
        settings,
      });

      console.log("ç¿»è¯‘ç»“æœ:", result);
    },
  },
};
```

### preload.js å…³é”®ç‚¹

1. **é»˜è®¤å¯¼å‡ºå¯¹è±¡**ï¼š`module.exports = { ... }`
2. **å¯¹è±¡çš„ key**ï¼šå¿…é¡»ä¸ `manifest.json` ä¸­ `feature` çš„ `path` ä¸€è‡´ï¼ˆå¦‚ `text-translate`ï¼‰
3. **onEnter å‡½æ•°**ï¼šå½“åŠŸèƒ½è¢«æ‰§è¡Œæ—¶è°ƒç”¨
4. **main é…ç½®**ï¼š
   - åœ¨ manifest.json é¡¶å±‚é…ç½® `main`ï¼ˆæ‰€æœ‰ feature å…±ç”¨ï¼‰
   - å¦‚æœé…ç½®äº† `main`ï¼Œçª—å£ä¼šè‡ªåŠ¨æ‰“å¼€å¹¶åŠ è½½è¯¥é¡µé¢
   - å¦‚æœ `main` ä¸ºç©ºæˆ–ä¸é…ç½®ï¼Œåˆ™ä¸æ‰“å¼€çª—å£ï¼Œåªæ‰§è¡Œ onEnter

---

## ğŸ”„ æ‰§è¡Œæµç¨‹

### 1. æ’ä»¶åŠ è½½é˜¶æ®µ

```mermaid
graph LR
    A[åº”ç”¨å¯åŠ¨] --> B[è¯»å–æ’ä»¶ç›®å½•]
    B --> C[è§£æ manifest.json]
    C --> D[æå– feature åˆ—è¡¨]
    D --> E[ç”Ÿæˆ PluginConfig]
    E --> F[ä¸åŠ è½½ preload.js]
    F --> G[æ’ä»¶åˆ—è¡¨å°±ç»ª]
```

**å…³é”®ä»£ç ä½ç½®**ï¼š`src/renderer/src/temp_code/modules/plugin/modules/local.ts`

```typescript
// åªè¯»å– manifest.jsonï¼Œä¸åŠ è½½ preload.js
const manifest = await naimo.router.filesystemReadFileJson(manifestPath);
const plugin: PluginConfig = {
  id: manifest.id,
  name: manifest.name,
  version: manifest.version,
  main: manifest.main, // æ’ä»¶çº§åˆ«çš„ main
  preload: manifest.preload, // æ’ä»¶çº§åˆ«çš„ preload
  feature: manifest.feature || [], // åŠŸèƒ½åˆ—è¡¨
  enabled: manifest.enabled ?? true,
};

// ä¸ºæ¯ä¸ª feature æ·»åŠ  pluginId
plugin.feature = plugin.feature.map((item) => ({
  ...item,
  pluginId: plugin.id,
}));
```

### 2. æ’ä»¶æ‰§è¡Œé˜¶æ®µ

```mermaid
graph LR
    A[ç”¨æˆ·è§¦å‘åŠŸèƒ½] --> B[è§¦å‘ plugin:executed äº‹ä»¶]
    B --> C[App.vue ç›‘å¬äº‹ä»¶]
    C --> D[è·å–æ’ä»¶é…ç½®]
    D --> E{æ’ä»¶é…ç½®äº† main?}
    E -->|æ˜¯| F[æ‰“å¼€æ’ä»¶çª—å£]
    E -->|å¦| G[ä¸æ‰“å¼€çª—å£]
    F --> H[åŠ è½½ preload.js]
    G --> H
    H --> I[æ ¹æ® feature.path æ‰¾åˆ° onEnter]
    I --> J[æ‰§è¡Œ onEnter å‡½æ•°]
```

**å…³é”®ä»£ç ä½ç½®**ï¼š`src/renderer/src/App.vue`

```typescript
app.event.on(
  "plugin:executed",
  async (event: {
    pluginId: string;
    path: string; // feature çš„ path
    hotkeyEmit: boolean;
    item: PluginItem;
  }) => {
    const { item, pluginId } = event;

    // è·å–æ’ä»¶é…ç½®
    const plugin = app.plugin.getPlugin(pluginId);
    if (!plugin) {
      console.error(`æ’ä»¶æœªæ‰¾åˆ°: ${pluginId}`);
      return;
    }

    // 1. å¦‚æœæ’ä»¶é…ç½®äº† mainï¼Œæ‰“å¼€çª—å£
    if (plugin.main) {
      await naimo.router.windowCreatePluginView({
        path: `${pluginId}:${item.path}`, // å®Œæ•´è·¯å¾„
        title: item.name,
        url: plugin.main, // ä½¿ç”¨æ’ä»¶çº§åˆ«çš„ main
        lifecycleType: item.lifecycleType || "reuse",
        preload: plugin.preload, // ä½¿ç”¨æ’ä»¶çº§åˆ«çš„ preload
        singleton: item.singleton ?? true,
        featurePath: item.path, // ä¼ é€’ feature path ç»™ preload
      });
    } else {
      // 2. å¦‚æœæ²¡æœ‰é…ç½® mainï¼Œç›´æ¥æ‰§è¡Œ preload ä¸­çš„ onEnter
      // éœ€è¦é€šè¿‡å…¶ä»–æ–¹å¼è°ƒç”¨ onEnterï¼ˆå¦‚ IPCï¼‰
    }
  }
);
```

### 3. preload.js æ‰§è¡Œé€»è¾‘

```javascript
// preload.js ä¸­çš„å¤„ç†
const featureHandlers = {
  "text-translate": {
    onEnter: async (params, api) => {
      // æ‰§è¡Œå…·ä½“é€»è¾‘
    },
  },
  "quick-translate": {
    onEnter: async (params, api) => {
      // æ‰§è¡Œå…·ä½“é€»è¾‘
    },
  },
};

// å½“åŠŸèƒ½è¢«è§¦å‘æ—¶ï¼Œä¸»è¿›ç¨‹ä¼šè°ƒç”¨å¯¹åº”çš„ handler
window.addEventListener("DOMContentLoaded", () => {
  // è·å–å½“å‰æ‰§è¡Œçš„åŠŸèƒ½ pathï¼ˆä» URL å‚æ•°æˆ–çª—å£é…ç½®ï¼‰
  const featurePath = getFeaturePathFromConfig(); // å¦‚ "text-translate"
  const handler = featureHandlers[featurePath];

  if (handler && handler.onEnter) {
    // æ‰§è¡Œ onEnter
    handler.onEnter(getExecutionParams(), getPluginAPI());
  }
});

// å¯¼å‡ºå¤„ç†å™¨
module.exports = featureHandlers;
```

---

## ğŸ—‘ï¸ ç§»é™¤çš„å†…å®¹

### 1. config.js æ–‡ä»¶

- **åŸå› **ï¼šæ‰€æœ‰é…ç½®éƒ½ç§»åˆ° `manifest.json` çš„ `feature` å­—æ®µ
- **è¿ç§»æ–¹æ³•**ï¼šå°† `config.js` ä¸­çš„é…ç½®è½¬æ¢ä¸º JSON æ ¼å¼

### 2. onInstall å›è°ƒ

- **åŸå› **ï¼šå®‰è£…æ—¶ä¸å†æ‰§è¡Œä»£ç ï¼Œé¿å…ä¸»è¿›ç¨‹è‡ƒè‚¿
- **æ›¿ä»£æ–¹æ¡ˆ**ï¼šå¦‚éœ€åˆå§‹åŒ–ï¼Œå¯åœ¨é¦–æ¬¡æ‰§è¡Œæ—¶æ£€æŸ¥å¹¶åˆå§‹åŒ–

### 3. feature ä¸­çš„ main å’Œ preload

- **åŸå› **ï¼šç»Ÿä¸€åœ¨æ’ä»¶é¡¶å±‚é…ç½®ï¼Œé¿å…é‡å¤
- **å¥½å¤„**ï¼šç®€åŒ–é…ç½®ï¼Œæ‰€æœ‰åŠŸèƒ½å…±ç”¨åŒä¸€ä¸ªé¡µé¢å’Œè„šæœ¬

---

## ğŸ“Š ç±»å‹å®šä¹‰æ›´æ–°

### pluginTypes.ts

```typescript
export interface PluginConfig {
  id: string;
  name: string;
  version: string;

  // æ’ä»¶çº§åˆ«é…ç½®ï¼ˆæ‰€æœ‰ feature å…±ç”¨ï¼‰
  main?: string; // âŒ UI é¡µé¢è·¯å¾„ï¼ˆå¯é€‰ï¼‰
  preload: string; // âœ… preload è„šæœ¬è·¯å¾„ï¼ˆå¿…å¡«ï¼‰

  // æ–°å¢ feature
  feature: PluginItem[]; // âœ… åŠŸèƒ½åˆ—è¡¨

  settings?: SettingConfig[];
  enabled: boolean;
}

export type PluginItem = AppItem & {
  pluginId?: string;
  lifecycleType?: LifecycleType;
  singleton?: boolean;

  // ç§»é™¤å­—æ®µï¼ˆä¸å…è®¸å‡½æ•°ï¼Œä¹Ÿä¸éœ€è¦ main/preloadï¼‰
  // main?: string      âŒ å·²åœ¨ PluginConfig é¡¶å±‚é…ç½®
  // preload?: string   âŒ å·²åœ¨ PluginConfig é¡¶å±‚é…ç½®
  // onEnter?: Function  âŒ ä¸å…è®¸åœ¨é…ç½®ä¸­å‡ºç°å‡½æ•°
  // onInstall?: Function  âŒ ä¸å…è®¸åœ¨é…ç½®ä¸­å‡ºç°å‡½æ•°
};
```

---

## ğŸ” å…³é”®æ–‡ä»¶ä¿®æ”¹æ¸…å•

### 1. æ’ä»¶åŠ è½½å™¨

**æ–‡ä»¶**ï¼š`src/renderer/src/temp_code/modules/plugin/modules/local.ts`

**ä¿®æ”¹ç‚¹**ï¼š

- âœ… åªè¯»å– `manifest.json`
- âœ… è§£æ `feature` å­—æ®µ
- âœ… ä»é¡¶å±‚è¯»å– `main` å’Œ `preload`ï¼ˆæ‰€æœ‰ feature å…±ç”¨ï¼‰
- âœ… ä¸ºæ¯ä¸ª feature æ·»åŠ  `pluginId` å­—æ®µ
- âŒ ä¸åŠ è½½ `config.js`
- âŒ ä¸æ‰§è¡Œ `onInstall`

### 2. åº”ç”¨äº‹ä»¶ç›‘å¬

**æ–‡ä»¶**ï¼š`src/renderer/src/App.vue`

**ä¿®æ”¹ç‚¹**ï¼š

- âœ… ç›‘å¬ `plugin:executed` äº‹ä»¶
- âœ… è·å–æ’ä»¶é…ç½®ï¼Œä½¿ç”¨æ’ä»¶çº§åˆ«çš„ `main` å’Œ `preload`
- âœ… è°ƒç”¨ `createPluginView` æ—¶ä¼ é€’ `featurePath`
- âœ… æ ¹æ®æ’ä»¶é…ç½®çš„ `main` å†³å®šæ˜¯å¦æ‰“å¼€çª—å£

### 3. ç±»å‹å®šä¹‰

**æ–‡ä»¶**ï¼š`src/renderer/src/typings/pluginTypes.ts`

**ä¿®æ”¹ç‚¹**ï¼š

- âœ… `PluginConfig.feature` æ›¿ä»£ `PluginConfig.items`
- âœ… `PluginConfig` æ–°å¢ `main` å’Œ `preload` å­—æ®µï¼ˆæ’ä»¶çº§åˆ«ï¼‰
- âŒ `PluginItem` ä¸éœ€è¦ `main` å’Œ `preload` å­—æ®µ
- âŒ ç§»é™¤ `onEnter` å’Œ `onInstall` ç±»å‹

### 4. çª—å£ç®¡ç†

**æ–‡ä»¶**ï¼š`src/main/ipc-router/modules/window.ts`

**ä¿®æ”¹ç‚¹**ï¼š

- âœ… `createPluginView` æ¥æ”¶ `featurePath` å‚æ•°
- âœ… æ”¯æŒ `main` ä¸ºç©ºçš„æƒ…å†µ
- âœ… preload è„šæœ¬è‡ªåŠ¨åŠ è½½å¹¶æ ¹æ® `featurePath` æ‰§è¡Œå¯¹åº”çš„ `onEnter`

---

## ğŸ“– ç¤ºä¾‹ï¼šå®Œæ•´çš„æ’ä»¶ç»“æ„

### manifest.json

```json
{
  "id": "translate-plugin",
  "name": "ç¿»è¯‘æ’ä»¶",
  "version": "1.0.0",
  "author": "Naimo Tools",
  "description": "æ™ºèƒ½æ–‡æœ¬ç¿»è¯‘å·¥å…·",
  "category": "ai_artificial_intelligence",
  "enabled": true,
  "main": "./index.html",
  "preload": "./preload.js",
  "feature": [
    {
      "path": "text-translate",
      "name": "æ–‡æœ¬ç¿»è¯‘",
      "icon": "ğŸŒ",
      "description": "æ™ºèƒ½æ–‡æœ¬ç¿»è¯‘å·¥å…·",
      "weight": 100,
      "type": "text",
      "anonymousSearchFields": ["imohuan_translate_text"],
      "lifecycleType": "reuse",
      "singleton": true
    },
    {
      "path": "quick-translate",
      "name": "å¿«é€Ÿç¿»è¯‘",
      "icon": "âš¡",
      "description": "å¿«é€Ÿç¿»è¯‘é€‰ä¸­æ–‡æœ¬",
      "weight": 90,
      "type": "text",
      "showInModes": ["attachment"],
      "lifecycleType": "new",
      "singleton": false
    }
  ],
  "settings": [
    {
      "name": "secretId",
      "title": "è…¾è®¯äº‘ Secret ID",
      "type": "input",
      "required": true
    }
  ]
}
```

### preload.js

```javascript
const { contextBridge } = require("electron");

// åŠŸèƒ½å¤„ç†å™¨æ˜ å°„ï¼ˆkey ä¸º feature çš„ pathï¼‰
const featureHandlers = {
  "text-translate": {
    onEnter: async (params, api) => {
      console.log("æ‰“å¼€æ–‡æœ¬ç¿»è¯‘ç•Œé¢");
      // UI å·²é€šè¿‡ main è‡ªåŠ¨æ‰“å¼€ï¼Œè¿™é‡Œå¯ä»¥åšåˆå§‹åŒ–
    },
  },

  "quick-translate": {
    onEnter: async (params, api) => {
      console.log("æ‰§è¡Œå¿«é€Ÿç¿»è¯‘", params);
      const settings = await api.getSettingValue();
      // æ‰§è¡Œç¿»è¯‘é€»è¾‘...
    },
  },
};

// å¯¼å‡ºå¤„ç†å™¨
module.exports = featureHandlers;

// æš´éœ²æ’ä»¶ API
contextBridge.exposeInMainWorld("translatePluginAPI", {
  // ... æ’ä»¶ç‰¹å®šçš„ API
});
```

---

## âœ… è¿ç§»æ­¥éª¤

### å¯¹äºç°æœ‰æ’ä»¶

1. **ä¿®æ”¹ manifest.json**
   - åœ¨é¡¶å±‚æ·»åŠ  `main` å’Œ `preload` é…ç½®ï¼ˆæ‰€æœ‰ feature å…±ç”¨ï¼‰
   - æ–°å¢ `feature` æ•°ç»„
   - å°†åŸ `config.js` ä¸­çš„åŠŸèƒ½é¡¹è½¬æ¢ä¸º JSON
   - feature ä¸­çš„ `path` åªéœ€è¦åŠŸèƒ½åç§°ï¼ˆå¦‚ `text-translate`ï¼‰
   - **ä¸è¦**åœ¨ feature ä¸­é…ç½® `main` å’Œ `preload`

2. **ä¿®æ”¹ preload.js**
   - æ·»åŠ é»˜è®¤å¯¼å‡ºå¯¹è±¡
   - å°† `onEnter` å‡½æ•°ç§»åˆ°å¯¹åº”çš„ path ä¸‹
   - key ä½¿ç”¨ç®€åŒ–çš„ pathï¼ˆå¦‚ `text-translate`ï¼Œä¸å¸¦æ’ä»¶IDå‰ç¼€ï¼‰

3. **åˆ é™¤ config.js**
   - æ‰€æœ‰é…ç½®å·²ç§»åˆ° `manifest.json`

4. **æµ‹è¯•**
   - éªŒè¯åŠŸèƒ½æ˜¯å¦æ­£å¸¸æ‰§è¡Œ
   - éªŒè¯çª—å£æ˜¯å¦æ­£å¸¸æ‰“å¼€

### å¯¹äºæ–°æ’ä»¶

ç›´æ¥ä½¿ç”¨æ–°æ¶æ„ï¼š

1. åˆ›å»º `manifest.json`
   - åœ¨é¡¶å±‚é…ç½® `main` å’Œ `preload`
   - æ·»åŠ  `feature` æ•°ç»„ï¼Œæ¯ä¸ª feature åªéœ€é…ç½® `path`ã€`name` ç­‰åŸºæœ¬å­—æ®µ
   - **ä¸è¦**åœ¨ feature ä¸­é…ç½® `main` å’Œ `preload`
2. åˆ›å»º `preload.js`
   - å¯¼å‡ºå¯¹è±¡ï¼Œkey ä¸º feature çš„ `path`
   - æ¯ä¸ª key å¯¹åº”ä¸€ä¸ªåŒ…å« `onEnter` çš„å¤„ç†å™¨
3. å¯é€‰ï¼šåˆ›å»º `index.html`ï¼ˆUI é¡µé¢ï¼‰

---

## ğŸ‰ ä¼˜åŠ¿æ€»ç»“

1. **æ€§èƒ½æå‡**ï¼šå¯åŠ¨æ—¶ä¸åŠ è½½ä»»ä½•æ’ä»¶ä»£ç ï¼Œå‡å°‘å†…å­˜å ç”¨
2. **æŒ‰éœ€åŠ è½½**ï¼šåªåœ¨æ‰§è¡Œæ—¶åŠ è½½å¯¹åº”çš„ preload.js
3. **æ›´ç®€å•**ï¼š
   - é…ç½®å…¨åœ¨ JSON ä¸­ï¼Œä¸éœ€è¦ç¼–å†™å¤æ‚çš„ config.js
   - `preload` åœ¨æ’ä»¶çº§åˆ«é…ç½®ï¼ˆå¿…å¡«ï¼‰ï¼Œæ‰€æœ‰ feature å…±ç”¨ï¼Œé¿å…é‡å¤
   - `main` å¯é€‰é…ç½®ï¼Œå¦‚æœä¸éœ€è¦ UI å¯ä»¥ä¸é…ç½®
   - feature çš„ `path` ç®€åŒ–ä¸ºåŠŸèƒ½åç§°ï¼Œæ— éœ€å¸¦æ’ä»¶IDå‰ç¼€
4. **æ›´å®‰å…¨**ï¼šé¿å…åœ¨ä¸»è¿›ç¨‹æ‰§è¡Œä¸å—ä¿¡ä»»çš„ä»£ç 
5. **æ˜“ç»´æŠ¤**ï¼šé…ç½®ä¸é€»è¾‘åˆ†ç¦»ï¼Œç»“æ„æ›´æ¸…æ™°
6. **æ›´çµæ´»**ï¼šæ¯ä¸ª feature å¯ç‹¬ç«‹é…ç½®ç”Ÿå‘½å‘¨æœŸå’Œè¡Œä¸º

---

## ğŸ”‘ å…³é”®è¦ç‚¹

1. âœ… **`preload` åœ¨æ’ä»¶é¡¶å±‚é…ç½®ä¸”ä¸ºå¿…å¡«**ï¼Œæ‰€æœ‰ feature å…±ç”¨
2. âœ… **`main` åœ¨æ’ä»¶é¡¶å±‚é…ç½®ä½†ä¸ºå¯é€‰**ï¼Œæœ‰ UI æ—¶æ‰éœ€è¦é…ç½®
3. âœ… **feature ä¸­çš„ `path` åªéœ€åŠŸèƒ½åç§°**ï¼Œå¦‚ `text-translate`
4. âœ… **preload.js ä¸­çš„ key ä¸ feature çš„ path å¯¹åº”**
5. âŒ **ä¸è¦åœ¨ feature ä¸­é…ç½® `main` å’Œ `preload`**
6. âŒ **ä¸å…è®¸åœ¨é…ç½®ä¸­å‡ºç°å‡½æ•°**ï¼ˆ`onEnter`ã€`onInstall`ï¼‰

---

## ğŸ“š å‚è€ƒ

- [åŸæ’ä»¶ç³»ç»Ÿæ–‡æ¡£](../../../docs/æ’ä»¶å¼€å‘æ–‡æ¡£.md)
- [çª—å£ç®¡ç†æ–‡æ¡£](../../../docs/è°ƒè¯•çª—å£è¯´æ˜.md)
- [IPC é…ç½®æ–‡æ¡£](../../../docs/IPCé…ç½®.md)
